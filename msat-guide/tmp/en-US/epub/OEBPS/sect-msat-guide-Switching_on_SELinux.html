<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1.8. Switching on SELinux</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="" /></head><body class="draft "><div class="section" id="sect-msat-guide-Switching_on_SELinux"><div class="titlepage"><div><div><h1 class="title" id="sect-msat-guide-Switching_on_SELinux">1.8. Switching on SELinux</h1></div></div></div><div class="table" id="tabl-msat-guide-Switching_on_SELinux-Time_needed"><h6>Table 1.24. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" style="text-align: left" class="c1" /><col width="50%" style="text-align: left" class="c2" /></colgroup><thead valign="top"><tr><th style="text-align: left" valign="top">
						action
					</th><th style="text-align: left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td style="text-align: left" valign="top">
						Create custom policy
					</td><td style="text-align: left" valign="top">
						5 minutes
					</td></tr></tbody></table></div></div><div class="para">
		In the last section, we have installed, registered and configured a system via Spacewalk. Meaning that all SELinux denials should now be logged in <code class="filename">/var/log/audit/audit.log</code>. In the standard logging, <code class="filename">/var/log/messages</code>, one should see <span class="bold bold"><strong>sealert</strong></span> messages. Running one message gives us the recipe to create a custom policy to make <span class="application"><strong>cobbler</strong></span> run under SELinux.
	</div><div class="para">
		First we detect the last <span class="bold bold"><strong>sealert</strong></span> message: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep sealert /var/log/messages</code></strong>
.
.
May 10 15:34:57 d19sw1 setroubleshoot: SELinux is preventing /usr/bin/python2.7 from link access on the file vmlinuz. For complete SELinux messages. run sealert -l 6cc70fe5-a8b9-4320-bf39-cac3b8c10656
.
.
May 10 19:48:07 d19sw1 setroubleshoot: SELinux is preventing /usr/sbin/httpd from search access on the directory /var/log/cobbler. For complete SELinux messages. run sealert -l 4fd01220-fd4c-4d89-9862-fe9d8e4397c0
.
.
</pre>
		 As the messages suggest, we run <code class="command">sealert</code>: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sealert -l 6cc70fe5-a8b9-4320-bf39-cac3b8c10656</code></strong>
.
.
# grep cobblerd /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp
.
.
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep cobblerd /var/log/audit/audit.log | audit2allow -M mycbpol</code></strong>
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i mycbpol.pp

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>semodule -i mycbpol.pp</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sealert -l 4fd01220-fd4c-4d89-9862-fe9d8e4397c0</code></strong>
.
.
# grep /usr/sbin/httpd /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp
.
.
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep /usr/sbin/httpd /var/log/audit/audit.log | audit2allow -M myhdpol</code></strong>
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i myhdpol.pp

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>semodule -i myhdpol.pp</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>vim /etc/selinux/config</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep ^SELINUX= /etc/selinux/config</code></strong>
SELINUX=enforcing
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>setenforce 1</code></strong>
</pre>

	</div><div class="para">
		To verify if SELinux is now behaving correctly, we have to recreate the Spacewalk content with respect to the <span class="bold bold"><strong>test01</strong></span> profile. Furthermore, we need to unregister the system and do the installation again.
	</div><div class="para">
		We demonstrate here how to unregister the system from the Spacewalk server. In the section <a class="xref" href="sect-msat-guide-MSAT_Demo.html">Section 1.9, “MSAT Demo”</a>, we show how to easily fill the Spacewalk with the <span class="bold bold"><strong>test01</strong></span> profile and attached items.
	</div><div class="important"><div class="admonition_header"><h2>SELinux web interface denials</h2></div><div class="admonition"><div class="para">
			SELinux is also preventing the web interface to work correctly. It manifests itself as the error: <span class="emphasis"><em>There are errors in your kickstart template. Please check the 'Kickstart File' tab to determine the problem with the template.</em></span> One can see this when clicking on a kickstart profile. To solve this issue, also run the <code class="command">sealert</code> command, as described earlier.
		</div></div></div></div></body></html>
