<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1.2. KVM host configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="" /></head><body class="draft "><div class="section" id="sect-msat-guide-KVM_host_configuration"><div class="titlepage"><div><div><h1 class="title" id="sect-msat-guide-KVM_host_configuration">1.2. KVM host configuration</h1></div></div></div><div class="table" id="tabl-msat-guide-KVM_host_configuration-Time_needed"><h6>Table 1.3. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" style="text-align: left" class="c1" /><col width="50%" style="text-align: left" class="c2" /></colgroup><thead valign="top"><tr><th style="text-align: left" valign="top">
						action
					</th><th style="text-align: left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td style="text-align: left" valign="top">
						virtual network creation
					</td><td style="text-align: left" valign="top">
						10 minutes
					</td></tr><tr><td style="text-align: left" valign="top">
						storage creation
					</td><td style="text-align: left" valign="top">
						10 minutes
					</td></tr><tr><td style="text-align: left" valign="top">
						memory verification
					</td><td style="text-align: left" valign="top">
						3 minutes
					</td></tr></tbody></table></div></div><div class="para">
		In this section we discuss what needs to be done on the host system. For the Spacewalk KVM, we need: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					A virtual network in which we let the Spacewalk server operate. In this network, we also add our test machine. This is the machine on which we test the provisioning.
				</div></li><li class="listitem"><div class="para">
					Disk storage. Eventually we want to have CentOS 5 and 6 content including all the minor versions. Furthermore, we want to have some space available for making exports and imports when the occasion arises. So 300GB should suffice.
				</div></li><li class="listitem"><div class="para">
					Memory for the virutal CPU. At least 2GB is needed. To give the Spacewalk server some power we use 4GB.
				</div></li></ul></div>

	</div><div class="section" id="sect-msat-guide-KVM_host_configuration-Virtual_network"><div class="titlepage"><div><div><h2 class="title" id="sect-msat-guide-KVM_host_configuration-Virtual_network">1.2.1. Virtual network</h2></div></div></div><div class="para">
			We assume that most people use <code class="systemitem">192.168.1.0/24</code> as their home network. Since we don't want to interfere, we use <code class="systemitem">192.168.5.0/24</code>. This is a virtual network that needs to be created on the host. For more background information look at <a href="http://libvirt.org/formatnetwork.html">libvirt.org/formatnetwork.html</a>.
		</div><div class="note"><div class="admonition_header"><h2>KVM virtualization must work on host</h2></div><div class="admonition"><div class="para">
				We assume that on the Linux host system KVM virtualization is working. If this is not the case, please make sure it works first. The <code class="systemitem">libvirtd</code> service must run. For more information, refer to <a href="http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html-single/Virtualization_Administration_Guide/index.html">Virtualization Administration Guide</a>.
			</div></div></div><div class="para">
			The virtual network can be created via the <code class="command">virsh</code> command line tool. Another way is the <code class="command">virt-manager</code> graphical tool. We first show how to use the command line tool, and then the graphical tool.
		</div><div class="para">
			We have the following XML file: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>cat dmsat1.xml</code></strong>
&lt;network&gt;
  &lt;name&gt;dmsat1&lt;/name&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:A8:05:01'/&gt;
  &lt;domain name='dmsat1.org'/&gt;
  &lt;ip address='192.168.5.1' netmask='255.255.255.0'/&gt;
&lt;/network&gt;
</pre>

		</div><div class="para">
			Note that the above MAC address, <code class="systemitem">52:54:00:A8:05:01</code>, is build up from the rules: 
			<div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>52:54:00</strong></span>, which is fixed by definition. See the section <span class="bold bold"><strong>Network Configuration</strong></span> of "man virt-install".
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>A8:05:01</strong></span>, which is the last 3 parts of <code class="systemitem">192.168.5.1</code> in hexadecimal.
					</div></li></ul></div>

		</div><div class="para">
			Now, create the network, mark it as autostart and activate it, with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-define dmsat1.xml</code></strong>
Network dmsat1 defined from test.xml

<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-autostart dmsat1</code></strong>
Network dmsat1 marked as autostarted

<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-start dmsat1</code></strong>
Network dmsat1 started

</pre>

		</div><div class="para">
			The command line method above, requires that one knows what must be specified in the XML file. Another way is to use the GUI, the <code class="command">virt-manager</code> command. Use the following clickpath: <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Connection Details</strong></span>. The <span class="guilabel"><strong>Connetion Details</strong></span> window pops up. In here, click: <span class="guimenu"><strong>Virtual Networks</strong></span> → <span class="guimenuitem"><strong>+ button</strong></span>. The <span class="guilabel"><strong>Create a new virtual network</strong></span> dialog pops up. Press <span class="guibutton"><strong>Forward</strong></span>. Enter <strong class="userinput"><code>dmsat1</code></strong> in the <span class="guilabel"><strong>Network Name:</strong></span> dialog box. Press <span class="guibutton"><strong>Forward</strong></span> again. The <span class="guilabel"><strong>Network:</strong></span> is <strong class="userinput"><code>192.168.5.0/24</code></strong>. Since, we don't use DHCP, unvink the <span class="guilabel"><strong>Enable DHCP:</strong></span> box. Press <span class="guibutton"><strong>Forward</strong></span>. Select the <span class="guilabel"><strong>Forwarding to physical network</strong></span> radio button. The <span class="guilabel"><strong>Destination:</strong></span> should be <strong class="userinput"><code>Any physical device</code></strong> and the <span class="guilabel"><strong>Mode:</strong></span> should be <strong class="userinput"><code>NAT</code></strong>. Press <span class="guibutton"><strong>Forward</strong></span> and then <span class="guibutton"><strong>Finish</strong></span>.
		</div><div class="para">
			Note that via the GUI method, one does not have the option of setting the MAC address to a specific value, like <code class="systemitem">52:54:00:A8:05:01</code>. Consequently, we prefer the command line method to create the virtual network.
		</div><div class="para">
			We assume that the newly created network is the second network after the <code class="code">default</code> network. Hence, it is connected to the <code class="code">virbr1</code> device. The network is defined in an XML file in <code class="filename">/etc/libvirt/qemu/networks</code>, named <code class="filename">dmsat1.xml</code>. It can be shown with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-dumpxml dmsat1</code></strong>
&lt;network&gt;
  &lt;name&gt;dmsat1&lt;/name&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:A8:05:01'/&gt;
  &lt;domain name='dmsat1.org'/&gt;
  &lt;ip address='192.168.5.1' netmask='255.255.255.0'/&gt;
&lt;/network&gt;
</pre>

		</div><div class="para">
			Make sure that the network is active and that it auto-starts: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-list</code></strong>
Name                 State      Autostart
-----------------------------------------
default              active     yes       
dmsat1               active     yes

</pre>

		</div></div><div class="section" id="sect-msat-guide-KVM_host_configuration-Storage_setup"><div class="titlepage"><div><div><h2 class="title" id="sect-msat-guide-KVM_host_configuration-Storage_setup">1.2.2. Storage setup</h2></div></div></div><div class="para">
			The KVM Spacewalk server needs disk space to run on. We provide it by means of a LV (Logical Volume) created on the host. The creation is done as follows: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>pvs</code></strong>
  PV         VG        Fmt  Attr PSize   PFree
  /dev/sda3  vg_server lvm2 a--  931.00g      0
  /dev/sdb   b         lvm2 a--  931.51g 931.51g
  /dev/sdc   c         lvm2 a--  931.51g 931.51g
  /dev/sdd   d         lvm2 a--  931.51g 931.51g
  /dev/sde   e         lvm2 a--  931.51g 931.51g
  /dev/sdf   f         lvm2 a--  931.51g 931.51g

<code class="prompt">server#</code> <strong class="userinput"><code>pvs -o +vg_extent_size /dev/sdb</code></strong>
  PV         VG   Fmt  Attr PSize   PFree   Ext
  /dev/sdb   b    lvm2 a--  931.51g 931.51g 4.00m

<code class="prompt">server#</code> <strong class="userinput"><code>lvcreate -n sw -l $((25 * 10 * 300)) b</code></strong>
  Logical volume "sw" created

</pre>

		</div><div class="para">
			The newly created LV, <code class="filename">/dev/b/sw</code>, can now be presented to the virtual machine creation command as block device for storage.
		</div></div><div class="section" id="sect-msat-guide-KVM_host_configuration-Memory_setup"><div class="titlepage"><div><div><h2 class="title" id="sect-msat-guide-KVM_host_configuration-Memory_setup">1.2.3. Memory setup</h2></div></div></div><div class="para">
			From the information of the Spacewalk project, see <a href="https://fedorahosted.org/spacewalk">fedorahosted.org/spacewalk</a>, we know from the <span class="bold bold"><strong>Spacewalk Installation Instructions</strong></span>, from a Prerequisites section that the minimum amount of RAM needed, is 2GB, but that 4GB is recommended. We know that on our host this requirement is no problem. We have 16GB of internal memory, which can be demonstrated with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>cat /proc/meminfo | grep ^MemTotal</code></strong>
MemTotal:       16435452 kB
</pre>

		</div></div></div></body></html>
