<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>msat-guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.8" /><meta name="package" content="MSAT-msat-guide-0.3-en-US-0.1-0" /><meta name="description" content="This guide explains how to setup a Spacewalk server to demonstrate the functioning of the MSAT scripts. The MSAT scripts use the Spacewalk API to automatically fill the Spacewalk server. The MSAT scripts have been created to automate the process of defining system types. The goal is to make the mechanisme efficient, to avoid errors and be versionable with system definitions." /></head><body class="draft "><p id="title"><a class="left" href="https://fedorahosted.org/publican"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="https://fedorahosted.org/publican"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><div xml:lang="en-US" class="book" id="idp3114464" lang="en-US"><div class="titlepage"><div><div class="producttitle"><span class="productname">MSAT</span> <span class="productnumber">0.3</span></div><div><h1 id="idp3114464" class="title">msat-guide</h1></div><div><h2 class="subtitle">MSAT guide</h2></div><p class="edition">Edition 0.1</p><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"> </object></span>

	</h3></div><div><div xml:lang="en-US" class="authorgroup" lang="en-US"><div class="author"><h3 class="author"><span class="firstname">Allard</span> <span class="surname">Berends</span></h3><div class="affiliation"><span class="orgname">Disruptivefoss</span> <span class="orgdiv">MSAT</span></div><code class="email"><a class="email" href="mailto:msat.disruptivefoss@gmail.com">msat.disruptivefoss@gmail.com</a></code></div></div></div><hr /><div><div id="idp20213760" class="legalnotice"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"></span>© 2013 | Allard Berends | This material may only be distributed subject to the terms and conditions set forth in the GNU Free Documentation License (GFDL), V1.2 or later (the latest version is presently available at <a href="http://www.gnu.org/licenses/fdl.txt">http://www.gnu.org/licenses/fdl.txt</a>).
	</div></div></div><div><div class="abstract"><h6>Abstract</h6><div class="para">
			This guide explains how to setup a Spacewalk server to demonstrate the functioning of the MSAT scripts. The MSAT scripts use the Spacewalk API to automatically fill the Spacewalk server. The MSAT scripts have been created to automate the process of defining system types. The goal is to make the mechanisme efficient, to avoid errors and be versionable with system definitions.
		</div></div></div></div><hr /></div><div class="toc"><dl><dt><span class="preface"><a href="#pref-msat-guide-Preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#idp31034352">1. Document Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#idp16811696">1.1. Typographic Conventions</a></span></dt><dt><span class="section"><a href="#idp19490928">1.2. Pull-quote Conventions</a></span></dt><dt><span class="section"><a href="#idp29844544">1.3. Notes and Warnings</a></span></dt></dl></dd><dt><span class="section"><a href="#sect-msat-guide-We_Need_Feedback">2. We Need Feedback!</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-msat-guide-Spacewalk">1. Spacewalk</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-prerequisites">1.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#spacewalk-host">1.2. KVM host configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-host-network">1.2.1. Virtual network</a></span></dt><dt><span class="section"><a href="#spacewalk-host-storage">1.2.2. Storage setup</a></span></dt><dt><span class="section"><a href="#spacewalk-host-memory">1.2.3. Memory setup</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-os_install">1.3. Fedora 18 installation</a></span></dt><dt><span class="section"><a href="#spacewalk-dns_conf">1.4. DNS configuration</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_install">1.5. Spacewalk installation</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling">1.6. Initial Spacewalk Filling</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-sw_filling-bc">1.6.1. Base channel</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-tools">1.6.2. Tools child channel</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-registration">1.6.3. Registration packages</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-kt">1.6.4. Kickstartable tree</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-test">1.7. Test Spacewalk</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-test-cc">1.7.1. Config Channel</a></span></dt><dt><span class="section"><a href="#spacewalk-test-ak">1.7.2. Activation Key</a></span></dt><dt><span class="section"><a href="#spacewalk-test-kp">1.7.3. Kickstart Profile</a></span></dt><dt><span class="section"><a href="#spacewalk-test-cob">1.7.4. Cobbler</a></span></dt><dt><span class="section"><a href="#spacewalk-test-kvm">1.7.5. KVM installation</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-selinux">1.8. Switching on SELinux</a></span></dt><dt><span class="section"><a href="#spacewalk-msat_demo">1.9. MSAT Demo</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-msat-guide-MSAT_scripts">2. MSAT scripts</a></span></dt><dd><dl><dt><span class="section"><a href="#msat-conf">2.1. MSAT configuration</a></span></dt><dt><span class="section"><a href="#msat-make">2.2. Make commands</a></span></dt><dt><span class="section"><a href="#msat-list">2.3. List commands</a></span></dt><dt><span class="section"><a href="#msat-remove">2.4. Remove commands</a></span></dt><dt><span class="section"><a href="#msat-write">2.5. Write commands</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appe-msat-guide-Revision_History">A. Revision History</a></span></dt><dt><span class="index"><a href="#idp3118832">Index</a></span></dt></dl></div><div xml:lang="en-US" class="preface" id="pref-msat-guide-Preface" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><div xml:lang="en-US" class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="idp31034352">1. Document Conventions</h2></div></div></div><div class="para">
		This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
	</div><div class="para">
		In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp16811696">1.1. Typographic Conventions</h3></div></div></div><div class="para">
			Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
		</div><div class="para">
			<code class="literal">Mono-spaced Bold</code>
		</div><div class="para">
			Used to highlight system input, including shell commands, file names and paths. Also used to highlight keycaps and key combinations. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div></blockquote></div><div class="para">
			The above includes a file name, a shell command and a keycap, all presented in mono-spaced bold and all distinguishable thanks to context.
		</div><div class="para">
			Key combinations can be distinguished from keycaps by the hyphen connecting each part of a key combination. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div><div class="para">
				Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> to switch to the first virtual terminal. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to return to your X-Windows session.
			</div></blockquote></div><div class="para">
			The first paragraph highlights the particular keycap to press. The second highlights two key combinations (each a set of three keycaps with each set pressed simultaneously).
		</div><div class="para">
			If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">mono-spaced bold</code>. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
			</div></blockquote></div><div class="para">
			<span class="application"><strong>Proportional Bold</strong></span>
		</div><div class="para">
			This denotes words or phrases encountered on a system, including application names; dialog box text; labeled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Choose <span class="guimenu"><strong>System</strong></span> → <span class="guisubmenu"><strong>Preferences</strong></span> → <span class="guimenuitem"><strong>Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
			</div><div class="para">
				To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications</strong></span> → <span class="guisubmenu"><strong>Accessories</strong></span> → <span class="guimenuitem"><strong>Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search</strong></span> → <span class="guimenuitem"><strong>Find…</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
			</div></blockquote></div><div class="para">
			The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in proportional bold and all distinguishable by context.
		</div><div class="para">
			<code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
		</div><div class="para">
			Whether mono-spaced bold or proportional bold, the addition of italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
			</div><div class="para">
				The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
			</div><div class="para">
				To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
			</div></blockquote></div><div class="para">
			Note the words in bold italics above — username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
		</div><div class="para">
			Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Publican is a <em class="firstterm">DocBook</em> publishing system.
			</div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp19490928">1.2. Pull-quote Conventions</h3></div></div></div><div class="para">
			Terminal output and source code listings are set off visually from the surrounding text.
		</div><div class="para">
			Output sent to a terminal is set in <code class="computeroutput">mono-spaced roman</code> and presented thus:
		</div><pre class="screen">books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs</pre><div class="para">
			Source-code listings are also set in <code class="computeroutput">mono-spaced roman</code> but add syntax highlighting as follows:
		</div><pre class="programlisting">package org.<span class="perl_Function">jboss</span>.<span class="perl_Function">book</span>.<span class="perl_Function">jca</span>.<span class="perl_Function">ex1</span>;

<span class="perl_Keyword">import</span> javax.naming.InitialContext;

<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> ExClient
{
   <span class="perl_Keyword">public</span> <span class="perl_DataType">static</span> <span class="perl_DataType">void</span> <span class="perl_Function">main</span>(String args[]) 
       <span class="perl_Keyword">throws</span> Exception
   {
      InitialContext iniCtx = <span class="perl_Keyword">new</span> InitialContext();
      Object         ref    = iniCtx.<span class="perl_Function">lookup</span>(<span class="perl_String">"EchoBean"</span>);
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.<span class="perl_Function">create</span>();

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Created Echo"</span>);

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Echo.echo('Hello') = "</span> + echo.<span class="perl_Function">echo</span>(<span class="perl_String">"Hello"</span>));
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp29844544">1.3. Notes and Warnings</h3></div></div></div><div class="para">
			Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Notes are tips, shortcuts or alternative approaches to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
			</div></div></div><div class="important"><div class="admonition_header"><h2>Important</h2></div><div class="admonition"><div class="para">
				Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring a box labeled 'Important' will not cause data loss but may cause irritation and frustration.
			</div></div></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Warnings should not be ignored. Ignoring warnings will most likely cause data loss.
			</div></div></div></div></div><div xml:lang="en-US" class="section" id="sect-msat-guide-We_Need_Feedback" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="sect-msat-guide-We_Need_Feedback">2. We Need Feedback!</h2></div></div></div><a id="idp15542560" class="indexterm"></a><div class="para">
		Although we put time and effort in this guide, it is very possible that errors have slipped in. We like to hear about them on <code class="email"><a class="email" href="mailto:msat.disruptivefoss@gmail.com">msat.disruptivefoss@gmail.com</a></code>
		 . Please put <span class="bold bold"><strong>msat-guide error</strong></span> in the subject field of the email.
	</div><div class="para">
		Furthermore, for suggestions, we would also like to hear from you on <code class="email"><a class="email" href="mailto:msat.disruptivefoss@gmail.com">msat.disruptivefoss@gmail.com</a></code>
		 . Please put <span class="bold bold"><strong>msat-guide suggestion</strong></span> in the subject field of the email.
	</div></div></div><div xml:lang="en-US" class="chapter" id="chap-msat-guide-Spacewalk" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 1. Spacewalk</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#spacewalk-prerequisites">1.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#spacewalk-host">1.2. KVM host configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-host-network">1.2.1. Virtual network</a></span></dt><dt><span class="section"><a href="#spacewalk-host-storage">1.2.2. Storage setup</a></span></dt><dt><span class="section"><a href="#spacewalk-host-memory">1.2.3. Memory setup</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-os_install">1.3. Fedora 18 installation</a></span></dt><dt><span class="section"><a href="#spacewalk-dns_conf">1.4. DNS configuration</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_install">1.5. Spacewalk installation</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling">1.6. Initial Spacewalk Filling</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-sw_filling-bc">1.6.1. Base channel</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-tools">1.6.2. Tools child channel</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-registration">1.6.3. Registration packages</a></span></dt><dt><span class="section"><a href="#spacewalk-sw_filling-kt">1.6.4. Kickstartable tree</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-test">1.7. Test Spacewalk</a></span></dt><dd><dl><dt><span class="section"><a href="#spacewalk-test-cc">1.7.1. Config Channel</a></span></dt><dt><span class="section"><a href="#spacewalk-test-ak">1.7.2. Activation Key</a></span></dt><dt><span class="section"><a href="#spacewalk-test-kp">1.7.3. Kickstart Profile</a></span></dt><dt><span class="section"><a href="#spacewalk-test-cob">1.7.4. Cobbler</a></span></dt><dt><span class="section"><a href="#spacewalk-test-kvm">1.7.5. KVM installation</a></span></dt></dl></dd><dt><span class="section"><a href="#spacewalk-selinux">1.8. Switching on SELinux</a></span></dt><dt><span class="section"><a href="#spacewalk-msat_demo">1.9. MSAT Demo</a></span></dt></dl></div><div class="para">
		This chapter discusses how to setup a Spacewalk server to test the MSAT scripts. Without a Spacewalk server (or Satellite server for that matter), it is hard to understand what the MSAT scripts do. Experimenting with the scripts is, in our opinion, very important.
	</div><div class="warning"><div class="admonition_header"><h2>Get a working Spacewalk server first</h2></div><div class="admonition"><div class="para">
			Setting up a Spacewalk server is cumbersome. Hence, we advice the reader to strictly follow the instructions given. Once a working Spacewalk server is at your disposal, it is easier to tweak or customize.
		</div></div></div><div class="para">
		In this chapter, we ask the reader to download items. We give an estimation of the download time. It is based on our own tests, but downloads can depend on a number of things: the speed of your local ISP (Internet Service Provider) and the speed of a server from which you download. So, we did a test via <a href="http://www.speedtest.net/">www.speedtest.net</a>. The results were: 
		<div class="table" id="tabl-msat-guide-Spacewalk-Speedtest_results"><h6>Table 1.1. Speedtest results</h6><div class="table-contents"><table summary="Speedtest results" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
							test
						</th><th align="left" valign="top">
							speed
						</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
							ping
						</td><td align="left" valign="top">
							6 ms
						</td></tr><tr><td align="left" valign="top">
							download
						</td><td align="left" valign="top">
							7.71 Mbps
						</td></tr><tr><td align="left" valign="top">
							upload
						</td><td align="left" valign="top">
							0.84 Mbps
						</td></tr></tbody></table></div></div><br class="table-break" />

	</div><div class="para">
		Setting up a spacewalk server takes a number of steps. We mention them here and elaborate on them in later sections. We think that it is important to give the recipe here in order to get the concept accross: 
		<div class="orderedlist"><ol><li class="listitem"><div class="para">
					Download the Fedora 18 DVD ISO image and store it on the Linux host on which we install the Spacewalk KVM machine.
				</div></li><li class="listitem"><div class="para">
					Prepare a Linux host on which we can install a Fedora 18 x86_64 KVM machine. On the host, enough memory (&gt;4 GB) and disk space (&gt; 300 GB, initially 80 GB will do), must be made available to the Spacewalk node.
				</div></li><li class="listitem"><div class="para">
					Install the Fedora 18 distribution on the KVM machine and configure the system.
				</div></li><li class="listitem"><div class="para">
					Install Spacewalk 1.9 on the Fedora 18 KVM machine and configure Spacewalk.
				</div></li><li class="listitem"><div class="para">
					Create a minimal working Spacewalk server by filling it with CentOS 5.8 RPM's and creating a kickstartable tree.
				</div></li><li class="listitem"><div class="para">
					Test the Spacewalk server by provisioning a simple CentOS 5.8 system. By provisioning we mean: automatic installation, registration and configuration.
				</div></li></ol></div>

	</div><div class="para">
		In the remainder of the chapter we discuss the steps. We keep the amount of information limited. In appendix ... we show screen dumps and extra information.
	</div><div xml:lang="en-US" class="section" id="spacewalk-prerequisites" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-prerequisites">1.1. Prerequisites</h2></div></div></div><div class="table" id="tabl-msat-guide-Prerequisites-Time_needed"><h6>Table 1.2. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Fedora 18 download
					</td><td align="left" valign="top">
						76 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		On the host system, make a location where the downloaded ISO can be stored: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>mkdir /var/isos</code></strong></pre>
		 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Download the Fedora 18 DVD, see <a href="http://download.fedoraproject.org/pub/fedora/linux/releases/18/Fedora/x86_64/iso/Fedora-18-x86_64-DVD.iso">Download Fedora 18</a> and store it in <code class="filename">/var/isos</code>.
				</div></li></ul></div>
		 After the download, our <code class="filename">/var/isos</code> is: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>ls -l /var/isos | grep Fedora-18</code></strong>
-rw-------. 1 qemu qemu 4573888512 Jan 15 20:30 Fedora-18-x86_64-DVD.iso
</pre>

	</div></div><div xml:lang="en-US" class="section" id="spacewalk-host" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-host">1.2. KVM host configuration</h2></div></div></div><div class="table" id="tabl-msat-guide-KVM_host_configuration-Time_needed"><h6>Table 1.3. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						virtual network creation
					</td><td align="left" valign="top">
						10 minutes
					</td></tr><tr><td align="left" valign="top">
						storage creation
					</td><td align="left" valign="top">
						10 minutes
					</td></tr><tr><td align="left" valign="top">
						memory verification
					</td><td align="left" valign="top">
						3 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		In this section we discuss what needs to be done on the host system. For the Spacewalk KVM, we need: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					A virtual network in which we let the Spacewalk server operate. In this network, we also add our test machine. This is the machine on which we test the provisioning.
				</div></li><li class="listitem"><div class="para">
					Disk storage. Eventually we want to have CentOS 5 and 6 content including all the minor versions. Furthermore, we want to have some space available for making exports and imports when the occasion arises. So 300GB should suffice.
				</div></li><li class="listitem"><div class="para">
					Memory for the virutal CPU. At least 2GB is needed. To give the Spacewalk server some power we use 4GB.
				</div></li></ul></div>

	</div><div class="section" id="spacewalk-host-network"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-host-network">1.2.1. Virtual network</h3></div></div></div><div class="para">
			We assume that most people use <code class="systemitem">192.168.1.0/24</code> as their home network. Since we don't want to interfere, we use <code class="systemitem">192.168.5.0/24</code>. This is a virtual network that needs to be created on the host. For more background information look at <a href="http://libvirt.org/formatnetwork.html">libvirt.org/formatnetwork.html</a>.
		</div><div class="note"><div class="admonition_header"><h2>KVM virtualization must work on host</h2></div><div class="admonition"><div class="para">
				We assume that on the Linux host system KVM virtualization is working. If this is not the case, please make sure it works first. The <code class="systemitem">libvirtd</code> service must run. For more information, refer to <a href="http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html-single/Virtualization_Administration_Guide/index.html">Virtualization Administration Guide</a>.
			</div></div></div><div class="para">
			The virtual network can be created via the <code class="command">virsh</code> command line tool. Another way is the <code class="command">virt-manager</code> graphical tool. We first show how to use the command line tool, and then the graphical tool.
		</div><div class="para">
			We have the following XML file: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>cat dmsat1.xml</code></strong>
&lt;network&gt;
  &lt;name&gt;dmsat1&lt;/name&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:A8:05:01'/&gt;
  &lt;domain name='dmsat1.org'/&gt;
  &lt;ip address='192.168.5.1' netmask='255.255.255.0'/&gt;
&lt;/network&gt;
</pre>

		</div><div class="para">
			Note that the above MAC address, <code class="systemitem">52:54:00:A8:05:01</code>, is build up from the rules: 
			<div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>52:54:00</strong></span>, which is fixed by definition. See the section <span class="bold bold"><strong>Network Configuration</strong></span> of "man virt-install".
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>A8:05:01</strong></span>, which is the last 3 parts of <code class="systemitem">192.168.5.1</code> in hexadecimal.
					</div></li></ul></div>

		</div><div class="para">
			Now, create the network, mark it as autostart and activate it, with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-define dmsat1.xml</code></strong>
Network dmsat1 defined from test.xml

<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-autostart dmsat1</code></strong>
Network dmsat1 marked as autostarted

<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-start dmsat1</code></strong>
Network dmsat1 started

</pre>

		</div><div class="para">
			The command line method above, requires that one knows what must be specified in the XML file. Another way is to use the GUI, the <code class="command">virt-manager</code> command. Use the following clickpath: <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Connection Details</strong></span>. The <span class="guilabel"><strong>Connetion Details</strong></span> window pops up. In here, click: <span class="guimenu"><strong>Virtual Networks</strong></span> → <span class="guimenuitem"><strong>+ button</strong></span>. The <span class="guilabel"><strong>Create a new virtual network</strong></span> dialog pops up. Press <span class="guibutton"><strong>Forward</strong></span>. Enter <strong class="userinput"><code>dmsat1</code></strong> in the <span class="guilabel"><strong>Network Name:</strong></span> dialog box. Press <span class="guibutton"><strong>Forward</strong></span> again. The <span class="guilabel"><strong>Network:</strong></span> is <strong class="userinput"><code>192.168.5.0/24</code></strong>. Since, we don't use DHCP, unvink the <span class="guilabel"><strong>Enable DHCP:</strong></span> box. Press <span class="guibutton"><strong>Forward</strong></span>. Select the <span class="guilabel"><strong>Forwarding to physical network</strong></span> radio button. The <span class="guilabel"><strong>Destination:</strong></span> should be <strong class="userinput"><code>Any physical device</code></strong> and the <span class="guilabel"><strong>Mode:</strong></span> should be <strong class="userinput"><code>NAT</code></strong>. Press <span class="guibutton"><strong>Forward</strong></span> and then <span class="guibutton"><strong>Finish</strong></span>.
		</div><div class="para">
			Note that via the GUI method, one does not have the option of setting the MAC address to a specific value, like <code class="systemitem">52:54:00:A8:05:01</code>. Consequently, we prefer the command line method to create the virtual network.
		</div><div class="para">
			We assume that the newly created network is the second network after the <code class="code">default</code> network. Hence, it is connected to the <code class="code">virbr1</code> device. The network is defined in an XML file in <code class="filename">/etc/libvirt/qemu/networks</code>, named <code class="filename">dmsat1.xml</code>. It can be shown with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-dumpxml dmsat1</code></strong>
&lt;network&gt;
  &lt;name&gt;dmsat1&lt;/name&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr1' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:A8:05:01'/&gt;
  &lt;domain name='dmsat1.org'/&gt;
  &lt;ip address='192.168.5.1' netmask='255.255.255.0'/&gt;
&lt;/network&gt;
</pre>

		</div><div class="para">
			Make sure that the network is active and that it auto-starts: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virsh net-list</code></strong>
Name                 State      Autostart
-----------------------------------------
default              active     yes       
dmsat1               active     yes

</pre>

		</div></div><div class="section" id="spacewalk-host-storage"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-host-storage">1.2.2. Storage setup</h3></div></div></div><div class="para">
			The KVM Spacewalk server needs disk space to run on. We provide it by means of a LV (Logical Volume) created on the host. The creation is done as follows: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>pvs</code></strong>
  PV         VG        Fmt  Attr PSize   PFree
  /dev/sda3  vg_server lvm2 a--  931.00g      0
  /dev/sdb   b         lvm2 a--  931.51g 931.51g
  /dev/sdc   c         lvm2 a--  931.51g 931.51g
  /dev/sdd   d         lvm2 a--  931.51g 931.51g
  /dev/sde   e         lvm2 a--  931.51g 931.51g
  /dev/sdf   f         lvm2 a--  931.51g 931.51g

<code class="prompt">server#</code> <strong class="userinput"><code>pvs -o +vg_extent_size /dev/sdb</code></strong>
  PV         VG   Fmt  Attr PSize   PFree   Ext
  /dev/sdb   b    lvm2 a--  931.51g 931.51g 4.00m

<code class="prompt">server#</code> <strong class="userinput"><code>lvcreate -n sw -l $((25 * 10 * 300)) b</code></strong>
  Logical volume "sw" created

</pre>

		</div><div class="para">
			The newly created LV, <code class="filename">/dev/b/sw</code>, can now be presented to the virtual machine creation command as block device for storage.
		</div></div><div class="section" id="spacewalk-host-memory"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-host-memory">1.2.3. Memory setup</h3></div></div></div><div class="para">
			From the information of the Spacewalk project, see <a href="https://fedorahosted.org/spacewalk">fedorahosted.org/spacewalk</a>, we know from the <span class="bold bold"><strong>Spacewalk Installation Instructions</strong></span>, from a Prerequisites section that the minimum amount of RAM needed, is 2GB, but that 4GB is recommended. We know that on our host this requirement is no problem. We have 16GB of internal memory, which can be demonstrated with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>cat /proc/meminfo | grep ^MemTotal</code></strong>
MemTotal:       16435452 kB
</pre>

		</div></div></div><div xml:lang="en-US" class="section" id="spacewalk-os_install" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-os_install">1.3. Fedora 18 installation</h2></div></div></div><div class="table" id="tabl-msat-guide-Fedora_18_installation-Time_needed"><h6>Table 1.4. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Fedora 18 installation
					</td><td align="left" valign="top">
						30 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		We use the Fedora 18 OS, as downloaded from <a href="http://download.fedoraproject.org/pub/fedora/linux/releases/18/Fedora/x86_64/iso/Fedora-18-x86_64-DVD.iso">Download Fedora 18 x86_64 ISO</a>. We do an interactive installation. Since we do a server installation, the Desktop parts (groups) are skipped.
	</div><div class="para">
		Explanation of the parameters in the <code class="command">virt-install</code> command: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					d19sw1, d (development), 19 (version 1.9), sw (spacewalk), 1 (first server).
				</div></li><li class="listitem"><div class="para">
					mac=52:54:00:a8:05:0b, 192.168.5.11 -&gt; 00:a8:05:0b, the 52:54:00 is obligatory by libvirt definition.
				</div></li></ul></div>
		 To make it easy to verify the <code class="command">virt-install</code> options in the <span class="emphasis"><em>virt-install man page</em></span>, we specify them in the same order as they appear in the man page.
	</div><div class="para">
		The installation is started with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virt-install \</code></strong>
  <strong class="userinput"><code>--connect qemu:///system \</code></strong>
  <strong class="userinput"><code>--name=d19sw1 \</code></strong>
  <strong class="userinput"><code>--ram=4096 \</code></strong>
  <strong class="userinput"><code>--arch=x86_64 \</code></strong>
  <strong class="userinput"><code>--description="Development Spacewalk server version 1.9" \</code></strong>
  <strong class="userinput"><code>--cdrom /var/isos/Fedora-18-x86_64-DVD.iso \</code></strong>
  <strong class="userinput"><code>--os-type=linux \</code></strong>
  <strong class="userinput"><code>--os-variant=fedora18 \</code></strong>
  <strong class="userinput"><code>--disk path=/dev/b/sw,device=disk,bus=scsi \</code></strong>
  <strong class="userinput"><code>--network=network=dmsat1,mac=52:54:00:a8:05:0b \</code></strong>
  <strong class="userinput"><code>--graphics vnc \</code></strong>
  <strong class="userinput"><code>--hvm \</code></strong>
  <strong class="userinput"><code>--autostart</code></strong>
.. output skipped ..
</pre>
		 The interactive installation is started. Answer the questions with the parameter values as specified below.
	</div><div class="para">
		<div class="table" id="tabl-msat-guide-Fedora_18_installation-Installation_parameters"><h6>Table 1.5. Installation parameters</h6><div class="table-contents"><table summary="Installation parameters" border="1"><colgroup><col width="33%" align="left" class="c1" /><col width="67%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
							question
						</th><th align="left" valign="top">
							answer
						</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
							language
						</td><td align="left" valign="top">
							English
						</td></tr><tr><td align="left" valign="top">
							Hostname
						</td><td align="left" valign="top">
							<code class="systemitem">d19sw1.dmsat1.org</code>
						</td></tr><tr><td align="left" valign="top">
							IPv4 settings
						</td><td align="left" valign="top">
							
						</td></tr><tr><td align="left" valign="top">
							Date &amp; Time
						</td><td align="left" valign="top">
							Europe/Amsterdam
						</td></tr><tr><td align="left" valign="top">
							Software selection
						</td><td align="left" valign="top">
							Minimal install
						</td></tr></tbody></table></div></div><br class="table-break" />

	</div><div class="para">
		With respect to partitioning, we don't need a <code class="filename">/home</code> partition. Consequently, it needs to be removed. The trick is to let the installer choose the partitioning automatically and then remove the space assigned to <code class="filename">/home</code> and add it to <code class="filename">/</code>. We want to end up with: 
		<div class="table" id="tabl-msat-guide-Fedora_18_installation-Partitioning_layout"><h6>Table 1.6. Partitioning layout</h6><div class="table-contents"><table summary="Partitioning layout" border="1"><colgroup><col width="33%" align="left" class="c1" /><col width="33%" align="left" class="c2" /><col width="33%" align="left" class="c3" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
							device
						</th><th align="left" valign="top">
							mountpoint
						</th><th align="left" valign="top">
							size
						</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
							<code class="filename">/dev/sda1</code>
						</td><td align="left" valign="top">
							<code class="filename">/boot</code>
						</td><td align="left" valign="top">
							500 MB
						</td></tr><tr><td align="left" valign="top">
							<code class="filename">/dev/sda2</code>
						</td><td align="left" valign="top">
							<code class="filename">PVS</code>
						</td><td align="left" valign="top">
							300 GB (remainder of disk)
						</td></tr><tr><td align="left" valign="top">
							<code class="filename">/dev/fedora_d19sw1/swap</code>
						</td><td align="left" valign="top">
							<code class="filename">None</code>
						</td><td align="left" valign="top">
							3968 MB
						</td></tr><tr><td align="left" valign="top">
							<code class="filename">/dev/fedora_d19sw1/root</code>
						</td><td align="left" valign="top">
							<code class="filename">/</code>
						</td><td align="left" valign="top">
							295524 MB (remainder of disk)
						</td></tr></tbody></table></div></div><br class="table-break" />

	</div><div class="para">
		We choose to update the Fedora 18 installation here with the latest patches: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>yum update</code></strong>
.. takes a while, about 10 minutes ..
</pre>

	</div><div class="para">
		After the installation we want to add some packages, do as <code class="systemitem">root</code>: 
<pre class="screen">
<strong class="userinput"><code>yum -y install bind-utils</code></strong>
<strong class="userinput"><code>yum -y install vim-enhanced</code></strong>
<strong class="userinput"><code>yum -y install tree</code></strong>
<strong class="userinput"><code>yum -y install screen</code></strong>
<strong class="userinput"><code>yum -y install net-tools</code></strong>
<strong class="userinput"><code>yum -y install tar</code></strong>
<strong class="userinput"><code>yum -y install mailx</code></strong>
<strong class="userinput"><code>yum -y install strace</code></strong>
<strong class="userinput"><code>yum -y install setroubleshoot</code></strong>
<strong class="userinput"><code>yum -y install syslinux</code></strong>
<strong class="userinput"><code>yum -y install bind-chroot</code></strong>
<strong class="userinput"><code>yum -y install mlocate</code></strong>
<strong class="userinput"><code>yum -y install wget</code></strong>
.. output of commands skipped ..
<strong class="userinput"><code>reboot</code></strong>
.. only if new kernel, rpm -qa | grep kernel ..
</pre>
		 We want to enable the virtual console on the KVM. This means that Grub2 and the kernel must know about the serial console. Adapt the <code class="filename">/etc/default/grub</code> file to include the following lines: 
<pre class="screen">
GRUB_CMDLINE_LINUX="rd.lvm.lv=fedora_d19sw1/swap rd.md=0 rd.dm=0 rd.lvm.lv=fedora_d19sw1/root $([ -x /usr/sbin/rhcrashkernel-param ] &amp;&amp; /usr/sbin/rhcrashkernel-param || :) rd.luks=0 vconsole.keymap=us console=ttyS0,115200n8"
GRUB_TERMINAL=serial
GRUB_SERIAL_COMMAND="serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1"
</pre>
		 Then, from the root prompt: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></strong>
Generating grub.cfg ...
Found linux image: /boot/vmlinuz-3.6.10-4.fc18.x86_64
Found initrd image: /boot/initramfs-3.6.10-4.fc18.x86_64.img
done
</pre>
		 Add ttyS0 to <code class="filename">/etc/securetty</code>: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo "ttyS0" &gt;&gt; /etc/securetty</code></strong></pre>
		 Enable the service in Fedora 18 with systemd: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /etc/systemd/system/getty.target.wants</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>ln -sf /usr/lib/systemd/system/serial-getty@.service serial-getty@ttyS0.service</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl start serial-getty@ttyS0.service</code></strong></pre>
		 Configure the firewall for Spacewalk and DNS, as <code class="systemitem">root</code>: 
<pre class="screen">
<strong class="userinput"><code>firewall-cmd --permanent --add-service=http</code></strong>
<strong class="userinput"><code>firewall-cmd --permanent --add-service=https</code></strong>
<strong class="userinput"><code>firewall-cmd --permanent --add-service=dns</code></strong>
<strong class="userinput"><code>firewall-cmd --permanent --add-port=5222/tcp</code></strong>
<strong class="userinput"><code>firewall-cmd --permanent --add-port=5269/tcp</code></strong>
<strong class="userinput"><code>firewall-cmd --reload</code></strong>
<strong class="userinput"><code>firewall-cmd --list-all</code></strong>
public
  interfaces: eth0
  services: mdns http dhcpv6-client https ssh dns
  ports: 6269/tcp 5222/tcp
  forward-ports:
  icmp-blocks:
</pre>

	</div></div><div xml:lang="en-US" class="section" id="spacewalk-dns_conf" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-dns_conf">1.4. DNS configuration</h2></div></div></div><div class="table" id="tabl-msat-guide-DNS_configuration-Time_needed"><h6>Table 1.7. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						DNS configuration
					</td><td align="left" valign="top">
						10 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		First of all, to be able to configure DNS, we need the software, if not yet available: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>yum install bind-chroot</code></strong>
.. output skipped ..
</pre>

	</div><div class="para">
		We want to set up the Spacewalk server as DNS server. In order for Spacewalk to function correctly, one needs DNS. During registration of provisioned hosts, Spacewalk does a reverse DNS query for the hostname of the registering host. In this section we describe how we configure DNS in the <span class="emphasis"><em>dmsat1</em></span> environment.
	</div><div class="para">
		We want DNS to behave in the following way: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					All DNS queries outside our domain, <code class="systemitem">dmsat1.org</code>, must go to the upstream DNS server, <code class="systemitem">192.168.1.1</code>. Consequently, we are a forwarding DNS server. The result queries must be cached.
				</div></li><li class="listitem"><div class="para">
					We want logging.
				</div></li><li class="listitem"><div class="para">
					The Spacewalk server is the name authority for <code class="systemitem">dmsat1.org</code>.
				</div></li></ul></div>

	</div><div class="para">
		Since we also want to keep track of the virtual MAC addresses, we use the main DNS zone file for keeping track of this administration.
	</div><div class="para">
		We just show all the DNS files here and explain afterwards how the directory structure looks: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /var/named/chroot/etc/named.conf</code></strong>
// /etc/named.conf

options {
  /*
   * Check names following RFC 952 and RFC 1123. The
   * master has strict checking. Incorrect names make
   * the nameserver fail. The slaves receive the names
   * from the master, hence those names are not
   * checked.
   */
  check-names master fail;
  check-names slave ignore;
  listen-on port 53 {
    192.168.5.11;
    127.0.0.1;
  };
  //listen-on-v6 port 53 { ::1; };
  directory   "/var/named";
  dump-file   "/var/named/data/cache_dump.db";
  statistics-file "/var/named/data/named_stats.txt";
  memstatistics-file "/var/named/data/named_mem_stats.txt";
  /*
   * To start out, we want all hosts to be able to
   * query this nameserver.
   */
  //allow-query     { localhost; };
  allow-query     { any; };
  //allow-query-on  { any; };
  //allow-query-on  { 192.168.1.16; 127.0.0.1; };
  recursion yes;
};

/*
 * Allowable log levels:
 * critical
 * error
 * warning
 * notice
 * info
 * debug [level]
 * dynamic
 */

/*
 * Allowable log categories:
 * client
 * config
 * database
 * default (all categories except queries)
 * delegation-only
 * dispatch
 * dnssec
 * general
 * lame-servers
 * network
 * notify
 * queries
 * resolver
 * security
 * unmatched
 * update
 * update-security
 * xfer-in
 * xfer-out
 */

logging {
  channel default_debug {
    file "/var/log/named.log" versions 5 size 5m;
    severity dynamic;
    print-time yes;
    print-severity yes;
    print-category yes;
  };

  category default { default_debug; };
  category queries { default_debug; };
};

/*
 * The '.' represents all other zones. We depend on the
 * upstream DNS server, 192.168.1.1, so all requests go
 * there. The answers are cached.
 */
zone "." IN {
  type forward;
  forward first;
  forwarders { 192.168.1.1; };
};

/*
 * Instead of including named.rfc1912.zones, we define our
 * localhost zones ourselves below.
 */
//include "/etc/named.rfc1912.zones";

zone "localhost.localdomain." IN {
  type master;
  file "named.localhost";
  allow-update { none; };
};

zone "localhost." IN {
  type master;
  file "named.localhost";
  allow-update { none; };
};

zone "127.in-addr.arpa." IN {
  type master;
  file "127.in-addr.arpa";
  allow-update { none; };
};

zone "dmsat1.org." IN {
  type master;
  file "dmsat1.org.zone";
  notify yes;
  allow-transfer { any; };
};

zone "5.168.192.in-addr.arpa." IN {
  type master;
  file "192.168.5.in-addr.arpa";
  notify yes;
  allow-transfer { any; };
};
</pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /var/named/chroot/var/named/127.in-addr.arpa</code></strong>
$TTL    86400
@       IN SOA d19sw1.dmsat1.org. root.d19sw1.dmsat1.org. (
        2012012300      ; serial, format: YYYYMMDDNN, where
      ; NN is the daily sequence number.
      ; After editing this file, always
      ; update this serial number to give
      ; slaves a chance to keep
      ; synchronized.
        3H              ; refresh. The refresh interval
      ; tells a slave for the zone how
      ; often to check that the data for
      ; this zone is up to date.
        15M             ; retry. If a slave fails to connect
      ; to the master, it will retry in
      ; this amount of time. So here it is
      ; 15 minutes.
        1W              ; expiry. If a slave did not contact
      ; the server for this amount of
      ; time, its records become useless,
      ; i.e. are expired.
        1D )            ; minimum. TTL for negative
      ; responses of this nameserver for
      ; authoriative requests. So the
      ; client must not ask for the same
      ; RR (Resource Record) it got a
      ; negative response for in the
      ; specified amount of time.

;
; @ is implied!
;
        IN NS   d19sw1.dmsat1.org.

;
; 127.0.0.0/8
;
; Satellite.
1.0.0   IN  PTR localhost.localdomain.
</pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /var/named/chroot/var/named/192.168.5.in-addr.arpa</code></strong>
$TTL    86400
@       IN SOA d19sw1.dmsat1.org. root.d19sw1.dmsat1.org. (
        2012012300      ; serial, format: YYYYMMDDNN, where
      ; NN is the daily sequence number.
      ; After editing this file, always
      ; update this serial number to give
      ; slaves a chance to keep
      ; synchronized.
        3H              ; refresh. The refresh interval
      ; tells a slave for the zone how
      ; often to check that the data for
      ; this zone is up to date.
        15M             ; retry. If a slave fails to connect
      ; to the master, it will retry in
      ; this amount of time. So here it is
      ; 15 minutes.
        1W              ; expiry. If a slave did not contact
      ; the server for this amount of
      ; time, its records become useless,
      ; i.e. are expired.
        1D )            ; minimum. TTL for negative
      ; responses of this nameserver for
      ; authoriative requests. So the
      ; client must not ask for the same
      ; RR (Resource Record) it got a
      ; negative response for in the
      ; specified amount of time.

;
; @ (short for domain name) is implied!
;
        IN NS   d19sw1.dmsat1.org.

;
; 192.168.5.0/24
;

; Development Spacewalk server.
10  IN  PTR d19sw0.dmsat1.org.
11  IN  PTR d19sw1.dmsat1.org.
12  IN  PTR d19sw2.dmsat1.org.
100 IN  PTR dmm01.dmsat1.org.
</pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /var/named/chroot/var/named/dmsat1.org.zone</code></strong>
$TTL    86400
@       IN SOA d19sw1.dmsat1.org. root.d19sw1.dmsat1.org. (
        2012012300      ; serial, format: YYYYMMDDNN, where
      ; NN is the daily sequence number.
      ; After editing this file, always
      ; update this serial number to give
      ; slaves a chance to keep
      ; synchronized.
        3H              ; refresh. The refresh interval
      ; tells a slave for the zone how
      ; often to check that the data for
      ; this zone is up to date.
        15M             ; retry. If a slave fails to connect
      ; to the master, it will retry in
      ; this amount of time. So here it is
      ; 15 minutes.
        1W              ; expiry. If a slave did not contact
      ; the server for this amount of
      ; time, its records become useless,
      ; i.e. are expired.
        1D )            ; minimum. TTL for negative
      ; responses of this nameserver for
      ; authoriative requests. So the
      ; client must not ask for the same
      ; RR (Resource Record) it got a
      ; negative response for in the
      ; specified amount of time.

;
; @ (short for domain name) is implied!
;
        IN NS   d19sw1.dmsat1.org.

;
; 192.168.5.0/24
;

;network   IN      A       192.168.5.0
;gateway   IN      A       192.168.5.1
; MAC_ETH0=52:54:00:a8:05:0a
d19sw0     IN      A       192.168.5.10
; MAC_ETH0=52:54:00:a8:05:0b
d19sw1     IN      A       192.168.5.11
; MAC_ETH0=52:54:00:a8:05:0c
d19sw2     IN      A       192.168.5.12
; MAC_ETH0=52:54:00:a8:05:64
dmm01      IN      A       192.168.5.100
;broadcast IN      A       192.168.5.255
</pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /var/named/chroot/var/named/named.localhost</code></strong>
$TTL    86400
@       IN SOA @ rname.invalid. (
        2012012300      ; serial, format: YYYYMMDDNN, where
      ; NN is the daily sequence number.
      ; After editing this file, always
      ; update this serial number to give
      ; slaves a chance to keep
      ; synchronized.
        3H              ; refresh. The refresh interval
      ; tells a slave for the zone how
      ; often to check that the data for
      ; this zone is up to date.
        15M             ; retry. If a slave fails to connect
      ; to the master, it will retry in
      ; this amount of time. So here it is
      ; 15 minutes.
        1W              ; expiry. If a slave did not contact
      ; the server for this amount of
      ; time, its records become useless,
      ; i.e. are expired.
        1D )            ; minimum. TTL for negative
      ; responses of this nameserver for
      ; authoriative requests. So the
      ; client must not ask for the same
      ; RR (Resource Record) it got a
      ; negative response for in the
      ; specified amount of time.

;
; @ is implied!
;
        NS  @
    A   127.0.0.1
    AAAA    ::1
</pre>

	</div><div class="para">
		In a directory tree, the structure looks like this: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>tree --charset=ASCII -F /var/named/chroot</code></strong>
/var/named/chroot
|-- dev/
|   |-- null
|   |-- random
|   `-- zero
|-- etc/
|   |-- localtime
|   |-- named/
|   |-- <span class="bold bold"><strong>named.conf</strong></span>
|   |-- named.iscdlv.key
|   |-- named.rfc1912.zones
|   |-- named.root.key
|   |-- pki/
|   |   `-- dnssec-keys/
|   `-- rndc.key
|-- usr/
|   `-- lib64/
|       `-- bind/
`-- var/
    |-- log/
    |   `-- named.log
    |-- named/
    |   |-- <span class="bold bold"><strong>127.in-addr.arpa</strong></span>
    |   |-- <span class="bold bold"><strong>192.168.5.in-addr.arpa</strong></span>
    |   |-- <span class="bold bold"><strong>dmsat1.org.zone</strong></span>
    |   |-- named.ca
    |   |-- named.empty
    |   |-- <span class="bold bold"><strong>named.localhost</strong></span>
    |   `-- named.loopback
    |-- run/
    |   `-- named/
    |       |-- named.pid
    |       `-- session.key
    `-- tmp/
</pre>

	</div><div class="para">
		Reconfigure the <code class="filename">/etc/resolv.conf</code> so that the <code class="systemitem">d19sw1.dmsat1.org</code> also resolvs to its own DNS: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sed -i 's/^DNS1=.*$/DNS1=192.168.5.11/' /etc/sysconfig/network-scripts/ifcfg-eth0</code></strong>
.. inotify informs NetworkManager ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /etc/resolv.conf</code></strong>
# Generated by NetworkManager
search dmsat1.org
nameserver 192.168.5.11
</pre>
		 If the change is not picked up, do: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl restart NetworkManager.service</code></strong></pre>

	</div><div class="para">
		Make sure to enable the service and start it: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl enable named-chroot.service</code></strong>
ln -s '/usr/lib/systemd/system/named-chroot.service' '/etc/systemd/system/multi-user.target.wants/named-chroot.service'
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl start named-chroot.service</code></strong></pre>

	</div><div class="para">
		Do some tests: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>for i in d19sw0.dmsat1.org d19sw1.dmsat1.org d19sw2.dmsat1.org dmm01.dmsat1.org d19sw0 d19sw1 d19sw2 dmm01 192.168.5.10 192.168.5.11 192.168.5.12 192.168.5.100; do host $i; done</code></strong>
d19sw0.dmsat1.org has address 192.168.5.10
d19sw1.dmsat1.org has address 192.168.5.11
d19sw2.dmsat1.org has address 192.168.5.12
dmm01.dmsat1.org has address 192.168.5.100
d19sw0.dmsat1.org has address 192.168.5.10
d19sw1.dmsat1.org has address 192.168.5.11
d19sw2.dmsat1.org has address 192.168.5.12
dmm01.dmsat1.org has address 192.168.5.100
10.5.168.192.in-addr.arpa domain name pointer d19sw0.dmsat1.org.
11.5.168.192.in-addr.arpa domain name pointer d19sw1.dmsat1.org.
12.5.168.192.in-addr.arpa domain name pointer d19sw2.dmsat1.org.
100.5.168.192.in-addr.arpa domain name pointer dmm01.dmsat1.org.
</pre>

	</div></div><div xml:lang="en-US" class="section" id="spacewalk-sw_install" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-sw_install">1.5. Spacewalk installation</h2></div></div></div><div class="table" id="tabl-msat-guide-Spacewalk_installation-Time_needed"><h6>Table 1.8. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Spacewalk installation
					</td><td align="left" valign="top">
						35 minutes
					</td></tr><tr><td align="left" valign="top">
						Spacewalk configuration
					</td><td align="left" valign="top">
						15 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		The information in this section is obtained from <a href="https://fedorahosted.org/spacewalk/wiki/HowToInstall">fedorahosted.org/spacewalk/wiki/HowToInstall</a> and our own experimenting.
	</div><div class="para">
		Because we experienced some problems with SELinux, we switch it off during the installation. Afterwards, we generate a new policy to ensure that Spacewalk run with SELinux in <span class="bold bold"><strong>enforcing</strong></span> mode. So, now set: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>vim /etc/selinux/config</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep ^SELINUX= /etc/selinux/config</code></strong>
SELINUX=permissive
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>setenforce 0</code></strong></pre>

	</div><div class="para">
		We first show the screen dumps of the installation. At some points we skip output. Otherwise a lot of space (about 4000 lines) is consumed. When noticable, but ignorable errors occur, we show them. Packages that just install well are skipped in the output.
	</div><div class="para">
		
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>rpm -Uvh http://yum.spacewalkproject.org/1.9/Fedora/18/x86_64/spacewalk-repo-1.9-1.fc18.noarch.rpm</code></strong>
Retrieving http://yum.spacewalkproject.org/1.9/Fedora/18/x86_64/spacewalk-repo-1.9-1.fc18.noarch.rpm
warning: /var/tmp/rpm-tmp.R8ZEmI: Header V4 DSA/SHA1 Signature, key ID 863a853d: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:spacewalk-repo-1.9-1.fc18        ################################# [100%]
</pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat &gt; /etc/yum.repos.d/jpackage-generic.repo &lt;&lt; EOF</code></strong>
<strong class="userinput"><code>[jpackage-generic]</code></strong>
<strong class="userinput"><code>name=JPackage generic</code></strong>
<strong class="userinput"><code>#baseurl=http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/</code></strong>
<strong class="userinput"><code>mirrorlist=http://www.jpackage.org/mirrorlist.php?dist=generic&amp;type=free&amp;release=5.0</code></strong>
<strong class="userinput"><code>enabled=1</code></strong>
<strong class="userinput"><code>gpgcheck=1</code></strong>
<strong class="userinput"><code>gpgkey=http://www.jpackage.org/jpackage.asc</code></strong>
<strong class="userinput"><code>EOF</code></strong></pre>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>yum install spacewalk-setup-embedded-postgresql</code></strong>
.
.
================================================================================
 Package                              Arch    Version          Repository  Size
================================================================================
Installing:
 spacewalk-setup-embedded-postgresql  noarch  1.9.1-1.fc18     spacewalk   12 k
Installing for dependencies:
 postgresql                           x86_64  9.2.3-1.fc18     updates    3.2 M
 postgresql-libs                      x86_64  9.2.3-1.fc18     updates    221 k
 postgresql-server                    x86_64  9.2.3-1.fc18     updates    3.6 M

Transaction Summary
================================================================================
Install  1 Package (+3 Dependent packages)

Total download size: 7.0 M
Installed size: 33 M
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong>
.
.
</pre>
		 Note, the following step takes about 30 minutes! 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>yum install spacewalk-postgresql</code></strong>
.
.
Transaction Summary
================================================================================
Install  1 Package  (+478 Dependent packages)
Upgrade             (  10 Dependent packages)

Total download size: 209 M
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong>
Downloading Packages:
(1/489): MessageQueue-3.26.7-1.fc18.noarch.rpm             |  18 kB   00:00
.
.
Retrieving key from http://www.jpackage.org/jpackage.asc
Importing GPG key 0xC431416D:
 Userid     : "JPackage Project (JPP Official Keys) &lt;jpackage@zarb.org&gt;"
 Fingerprint: 1f81 c0fb c2b8 22b3 de12 33a4 5c6c fff7 c431 416d
 From       : http://www.jpackage.org/jpackage.asc
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong>
.
.
  Installing : java-1.5.0-gcj-1.5.0.0-40.fc18.x86_64                    277/499
/var/tmp/rpm-tmp.Cn2QAL: line 11: /usr/share/java-utils/abs2rel.sh: No such file or directory
/var/tmp/rpm-tmp.Cn2QAL: line 18: /usr/share/java-utils/abs2rel.sh: No such file or directory
/var/tmp/rpm-tmp.Cn2QAL: line 24: /usr/share/java-utils/abs2rel.sh: No such file or directory
/var/tmp/rpm-tmp.Cn2QAL: line 28: /usr/share/java-utils/abs2rel.sh: No such file or directory
  Installing : sinjdoc-0.5-13.fc18.x86_64                               278/499
.
.
</pre>

	</div><div class="para">
		At this point we have the Spacewalk software installed. Now we will configure it. Again, we show this in screen dumps. 
		<div class="note"><div class="admonition_header"><h2>Follow the instructions exactly</h2></div><div class="admonition"><div class="para">
				It turns out that deviating from the installation instructions can result in a lot of trouble. Here, we want to make sure that we end up with a working Spacewalk server. Tweaking and experimenting can be done later!
			</div></div></div>
		 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>passwd postgres</code></strong>
Changing password for user postgres.
New password: <strong class="userinput"><code>redhat</code></strong>
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: <strong class="userinput"><code>redhat</code></strong>
passwd: all authentication tokens updated successfully.
</pre>
		 Completing the following section takes about 5 minutes! 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>spacewalk-setup --disconnected</code></strong>
** Database: Setting up database connection for PostgreSQL backend.
** Database: Installing the database:
** Database: This is a long process that is logged in:
** Database:   /var/log/rhn/install_db.log
*** Progress: ###
** Database: Installation complete.
** Database: Populating database.
*** Progress: ###################################
* Setting up users and groups.
** GPG: Initializing GPG and importing key.
** GPG: Creating /root/.gnupg directory
You must enter an email address.
Admin Email Address? <strong class="userinput"><code>root@localhost</code></strong>
* Performing initial configuration.
* Activating Spacewalk.
** Loading Spacewalk Certificate.
** Verifying certificate locally.
** Activating Spacewalk.
* Enabling Monitoring.
* Configuring apache SSL virtual host.
Should setup configure apache's default ssl server for you (saves original ssl.conf) [Y]? <strong class="userinput"><code>&lt;Enter&gt;</code></strong>
** /etc/httpd/conf.d/ssl.conf has been backed up to ssl.conf-swsave
* Configuring tomcat.
** /etc/sysconfig//tomcat has been backed up to tomcat-swsave
** /etc/tomcat//server.xml has been backed up to server.xml-swsave
** /etc/tomcat//web.xml has been backed up to web.xml-swsave
* Configuring jabberd.
* Creating SSL certificates.
CA certificate password? <strong class="userinput"><code>&lt;redhat&gt;</code></strong>
Re-enter CA certificate password? <strong class="userinput"><code>&lt;redhat&gt;</code></strong>
Organization? <strong class="userinput"><code>Example</code></strong>
Organization Unit [d19sw1.dmsat1.org]? <strong class="userinput"><code>dmsat1</code></strong>
Email Address [root@localhost]? <strong class="userinput"><code>&lt;Enter&gt;</code></strong>
City? <strong class="userinput"><code>Utrecht</code></strong>
State? <strong class="userinput"><code>Utrecht</code></strong>
Country code (Examples: "US", "JP", "IN", or type "?" to see a list)? <strong class="userinput"><code>NL</code></strong>
** SSL: Generating CA certificate.
** SSL: Deploying CA certificate.
** SSL: Generating server certificate.
** SSL: Storing SSL certificates.
* Deploying configuration files.
* Update configuration in database.
* Setting up Cobbler..
Processing /etc/cobbler/modules.conf
‘/etc/cobbler/modules.conf’ -&gt; ‘/etc/cobbler/modules.conf-swsave’
Processing /etc/cobbler/settings
‘/etc/cobbler/settings’ -&gt; ‘/etc/cobbler/settings-swsave’
cobblerd does not appear to be running/accessible
Cobbler requires tftp and xinetd services be turned on for PXE provisioning functionality. Enable these services [Y]? <strong class="userinput"><code>Enter</code></strong>
ln -s '/usr/lib/systemd/system/tftp.socket' '/etc/systemd/system/sockets.target.wants/tftp.socket'
cobblerd does not appear to be running/accessible
* Restarting services.
*******************************************************************
 Using the default of SSL_verify_mode of SSL_VERIFY_NONE for client
 is depreciated! Please set SSL_verify_mode to SSL_VERIFY_PEER
 together with SSL_ca_file|SSL_ca_path for verification.
 If you really don't want to verify the certificate and keep the
 connection open to Man-In-The-Middle attacks please set
 SSL_verify_mode explicitly to SSL_VERIFY_NONE in your application.
*******************************************************************
  at /usr/share/perl5/LWP/Protocol/http.pm line 31.
*******************************************************************
 Using the default of SSL_verify_mode of SSL_VERIFY_NONE for client
 is depreciated! Please set SSL_verify_mode to SSL_VERIFY_PEER
 together with SSL_ca_file|SSL_ca_path for verification.
 If you really don't want to verify the certificate and keep the
 connection open to Man-In-The-Middle attacks please set
 SSL_verify_mode explicitly to SSL_VERIFY_NONE in your application.
*******************************************************************
  at /usr/share/perl5/LWP/Protocol/http.pm line 31.
Installation complete.
Visit https://d19sw1.dmsat1.org to create the Spacewalk administrator account.
</pre>

	</div><div class="para">
		The installation program points us to the Spacewalk's web interface: <a href="http://192.168.5.11">http://192.168.5.11</a>. Here we need to configure the Spacewalk administrator account. We use the following set of parameters: 
		<div class="table" id="tabl-msat-guide-Spacewalk_installation-Spacewalk_admin_parameters"><h6>Table 1.9. Spacewalk admin parameters</h6><div class="table-contents"><table summary="Spacewalk admin parameters" border="1"><colgroup><col width="33%" align="left" class="c1" /><col width="67%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
							parameter
						</th><th align="left" valign="top">
							value
						</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
							Desired Login:
						</td><td align="left" valign="top">
							example
						</td></tr><tr><td align="left" valign="top">
							Desired Password:
						</td><td align="left" valign="top">
							redhat
						</td></tr><tr><td align="left" valign="top">
							Confirm Password:
						</td><td align="left" valign="top">
							redhat
						</td></tr><tr><td align="left" valign="top">
							Firt, Last Name:
						</td><td align="left" valign="top">
							Mr. Example Example
						</td></tr><tr><td align="left" valign="top">
							Email:
						</td><td align="left" valign="top">
							root@localhost
						</td></tr></tbody></table></div></div><br class="table-break" />
		 Now click Create Login. Remove <span class="guilabel"><strong>HTTP proxy settings</strong></span> and uncheck <span class="guilabel"><strong>Disconnected Spacewalk</strong></span> and press Update.
	</div><div class="para">
		The Spacewalk server mentions on the web interface that we need to restart the Spacewalk server: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>spacewalk-service restart</code></strong>
.. output skipped ..
</pre>

	</div><div class="para">
		In our case the Spacewalk certificate was still missing, so we copy it: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd ~/ssl-build</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp RHN-ORG-TRUSTED-SSL-CERT /usr/share/rhn/RHN-ORG-TRUSTED-SSL-CERT</code></strong></pre>

	</div><div class="para">
		We also want the Spacewalk service to start automatically at system boot: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl enable spacewalk.target</code></strong>
ln -s '/usr/lib/systemd/system/spacewalk.target' '/etc/systemd/system/multi-user.target.wants/spacewalk.target'
</pre>

	</div><div class="para">
		The Cobbler daemon still needs some adjustments. Change the following parameters in <code class="filename">/etc/cobbler/settings</code>: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>vim /etc/cobbler/settings</code></strong>
.
.
allow_duplicate_hostnames: 1
allow_duplicate_ips: 1
allow_duplicate_macs: 1
redhat_management_permissive: 1
.
.
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>systemctl restart cobblerd.service</code></strong></pre>

	</div><div class="para">
		This concludes our Spacewalk installation. The Spacewalk server is still in a state that we cannot provision systems. Hence, it needs filling!
	</div></div><div xml:lang="en-US" class="section" id="spacewalk-sw_filling" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-sw_filling">1.6. Initial Spacewalk Filling</h2></div></div></div><div class="table" id="tabl-msat-guide-Initial_Spacewalk_Filling-Time_needed"><h6>Table 1.10. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Download DVD1
					</td><td align="left" valign="top">
						77 minutes
					</td></tr><tr><td align="left" valign="top">
						Download DVD2
					</td><td align="left" valign="top">
						12 minutes
					</td></tr><tr><td align="left" valign="top">
						Download Spacewalk client tools
					</td><td align="left" valign="top">
						6 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		In this section we explain how we fill the Spacewalk server. Initially we fill it with a minimal set of RPM's to make it work.
	</div><div class="para">
		This raises the question, what is a functional Spacewalk server? We think that we have a minimal functioning Spacewalk server if: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					it can be used to install the OS on a system. The system may be a KVM machine.
				</div></li><li class="listitem"><div class="para">
					the installed system automatically registers to the Spacewalk server. I must show up in the list of systems of the Spacewalk web interface.
				</div></li><li class="listitem"><div class="para">
					the installed system automatically has access to configured software channel, besides the base channel. In other words: "yum repolist" on the installed system should give the configured software channels.
				</div></li><li class="listitem"><div class="para">
					the installed system automatically obtains RPM's from connected activation keys, and config files from connected config channels.
				</div></li></ul></div>

	</div><div class="para">
		To make the Spacewalk server function, we need to add RPM's from a Linux distribution. For this purpose, we use CentOS 5.8. Hence, we need to create a base channel and put RPM's into it. For registration and configuration we need some tools. We put these in a child channel. Finally, we need to create a kickstartable tree to do bare metal deployment. We show the steps in the following sections.
	</div><div class="section" id="spacewalk-sw_filling-bc"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-sw_filling-bc">1.6.1. Base channel</h3></div></div></div><div class="para">
			First, we create the base channel. Point the browser to <a href="http://192.168.5.11">http://192.168.5.11</a> and do: <span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Channels</strong></span> → <span class="guimenuitem"><strong>Manage Software Channels</strong></span> → <span class="guimenuitem"><strong>create new channel</strong></span> → <span class="guimenuitem"><strong>Channel Name: centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Channel Label: centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Parent Channel: None</strong></span> → <span class="guimenuitem"><strong>Architecture: x86_64</strong></span> → <span class="guimenuitem"><strong>Yum Repository Checksum Type: sha1</strong></span> → <span class="guimenuitem"><strong>Channel Summary: centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>GPG key URL: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5</strong></span>+<span class="guibutton"><strong>Create Channel</strong></span>
		</div><div class="para">
			The newly created channel needs to be filled. We use the following commands: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd</code></strong>
<code class="prompt">server#</code> <strong class="userinput"><code>wget http://mirror.nsc.liu.se/centos-store/5.8/isos/x86_64/CentOS-5.8-x86_64-bin-DVD-1of2.iso</code></strong>
.. output skipped ..
.. 77 minutes ..
<code class="prompt">server#</code> <strong class="userinput"><code>wget http://mirror.nsc.liu.se/centos-store/5.8/isos/x86_64/CentOS-5.8-x86_64-bin-DVD-2of2.iso</code></strong>
.. output skipped ..
.. 12 minutes ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget http://mirror.nsc.liu.se/centos-store/5.8/isos/x86_64/md5sum.txt</code></strong>
.. output skipped ..

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>md5sum CentOS-5.8-x86_64-bin-DVD-1of2.iso</code></strong>
8a3bf0030f192022943f83fe6b2cf373  CentOS-5.8-x86_64-bin-DVD-1of2.iso
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep CentOS-5.8-x86_64-bin-DVD-1of2.iso md5sum.txt</code></strong>
8a3bf0030f192022943f83fe6b2cf373  CentOS-5.8-x86_64-bin-DVD-1of2.iso

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>md5sum CentOS-5.8-x86_64-bin-DVD-2of2.iso</code></strong>
1d0d05edeb310c99a48fbef075695bb3  CentOS-5.8-x86_64-bin-DVD-2of2.iso
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep CentOS-5.8-x86_64-bin-DVD-2of2.iso md5sum.txt</code></strong>
1d0d05edeb310c99a48fbef075695bb3  CentOS-5.8-x86_64-bin-DVD-2of2.iso

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mkdir -p /var/www/html/pub/iso/{1,2}</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mount -o loop /root/CentOS-5.8-x86_64-bin-DVD-1of2.iso /var/www/html/pub/iso/1</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mount -o loop /root/CentOS-5.8-x86_64-bin-DVD-2of2.iso /var/www/html/pub/iso/2</code></strong>

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>spacewalk-repo-sync -c centos-x86_64-server-5 -u http://192.168.5.11/pub/iso/1</code></strong>
.. output skipped ..
3536/3595 : openoffice.org-langpack-hr_HR-3.1.1-19.5.el5_5.6-1.x86_64
failure: CentOS/openoffice.org-langpack-hr_HR-3.1.1-19.5.el5_5.6.x86_64.rpm from centos-x86_64-server-5: [Errno 256] No more mirrors to try.
http://192.168.5.11/pub/iso/1/CentOS/openoffice.org-langpack-hr_HR-3.1.1-19.5.el5_5.6.x86_64.rpm: [Errno 14] curl#22 - "The requested URL returned error: 404 Not Found"
.. output skipped ..
.. 4 hours and 30 minutes ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>rhnpush -d /var/www/html/pub/iso/2/CentOS/ -c centos-x86_64-server-5 -u example -p redhat --server $(hostname)</code></strong>
.. output skipped ..
.. 9 minutes ..
</pre>
			 The langpack errors can be ignored. Via the <code class="command">rhnpush</code> command, these packages are added.
		</div></div><div class="section" id="spacewalk-sw_filling-tools"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-sw_filling-tools">1.6.2. Tools child channel</h3></div></div></div><div class="para">
			Just using CentOS 5.8 will not do. Believe us, we learned the hard way! We also need extra RPM's to make automatic registration and configuration work. Hence, a second software channel is created.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Channels</strong></span> → <span class="guimenuitem"><strong>Manage Software Channels</strong></span> → <span class="guimenuitem"><strong>create new channel</strong></span> → <span class="guimenuitem"><strong>Channel Name: con-tools-centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Channel Label: con-tools-centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Parent Channel: centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Architecture: x86_64</strong></span> → <span class="guimenuitem"><strong>Yum Repository Checksum Type: sha1</strong></span> → <span class="guimenuitem"><strong>Channel Summary: con-tools-centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>GPG key URL: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-spacewalk-2012</strong></span>+<span class="guibutton"><strong>Create Channel</strong></span>
		</div><div class="warning"><div class="admonition_header"><h2>A software channel name cannot start with <span class="bold bold"><strong>rhn</strong></span></h2></div><div class="admonition"><div class="para">
				It is not possible to use the name <span class="bold bold"><strong>rhn-tools-centos-x86_64-server-5</strong></span>. Spacewalk forbids the use of <span class="bold bold"><strong>rhn</strong></span>. It is reserved for the Satellite server of Red Hat.
			</div></div></div><div class="para">
			We fill the tools channel with: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>spacewalk-repo-sync -c con-tools-centos-x86_64-server-5 -u http://spacewalk.redhat.com/yum/1.9-client/RHEL/5/x86_64</code></strong>
.. less than a minute ..
</pre>

		</div><div class="para">
			During one of the test installations (happens when <code class="command">rhnreg_ks</code> is run) we found out that the <span class="bold bold"><strong>con-tools-centos-x86_64-server-5</strong></span> channel is incomplete. We need an extra RPM called <span class="package">python-hashlib-20081119-4.el5.x86_64.rpm</span> because <span class="package">spacewalk-backend-libs-1.9.48-1.el5.noarch</span> depends on it. We download and push it to the channel with: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget http://dl.fedoraproject.org/pub/epel/5/x86_64/python-hashlib-20081119-4.el5.x86_64.rpm</code></strong>
.. output skipped ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>rhnpush -c con-tools-centos-x86_64-server-5 -u example -p redhat --server=$(hostname) python-hashlib-20081119-4.el5.x86_64.rpm</code></strong></pre>

		</div></div><div class="section" id="spacewalk-sw_filling-registration"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-sw_filling-registration">1.6.3. Registration packages</h3></div></div></div><div class="para">
			Some of the packages of the <span class="bold bold"><strong>con-tools-centos-x86_64-server-5</strong></span> channel need to be moved to the <span class="bold bold"><strong>centos-x86_64-server-5</strong></span> base channel. The reason lies in the fact that the <code class="filename">comps.xml</code> for the <span class="bold bold"><strong>base</strong></span> component contains the <span class="package">rhn-check</span>, <span class="package">rhn-setup</span> and <span class="package">yum-rhn-plugin</span> packages. These are needed for system registration. Including their dependencies, we come up with the following list: 
			<div class="orderedlist"><ol><li class="listitem"><div class="para">
						<span class="package">rhn-check-1.9.10-1.el5.noarch.rpm</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">rhn-client-tools-1.9.10-1.el5.noarch.rpm</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">rhnlib-2.5.55-1.el5.noarch.rpm</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">rhnsd-5.0.9-1.el5.x86_64.rpm</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">rhn-setup-1.9.10-1.el5.noarch.rpm</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">rhn-setup-gnome-1.9.10-1.el5.noarch</span>
					</div></li><li class="listitem"><div class="para">
						<span class="package">yum-rhn-plugin-1.9.4-1.el5.noarch.rpm</span>
					</div></li></ol></div>
			 Note that <span class="package">rhn-setup-gnome-1.9.10-1.el5.noarch</span> is added because it is in <code class="filename">comps.xml</code> too, under <span class="bold bold"><strong>x-base</strong></span>.
		</div><div class="note"><div class="admonition_header"><h2>Installing MSAT</h2></div><div class="admonition"><div class="para">
				Download the tarball from <a href="http://msat.disruptivefoss.org/Downloads/tarball/msat_scripts.tgz">http://msat.disruptivefoss.org/Downloads/tarball/msat_scripts.tgz</a>. On the Spacewalk server, do: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo 'PATH=$PATH:/usr/local/bin/msat' &gt; /etc/profile.d/msat.sh</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mkdir -p /usr/local/bin/msat</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /usr/local/bin/msat</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget msat.disruptivefoss.org/Downloads/tarball/msat_scripts.tgz</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>tar xzf msat_scripts.tgz</code></strong></pre>
				 A configuration file, <code class="filename">~/.sat.conf</code> is needed to. See . Make sure to set the <em class="replaceable"><code>login</code></em> to <em class="parameter"><code>example</code></em> and <em class="replaceable"><code>password</code></em> to <em class="parameter"><code>redhat</code></em>.
			</div></div></div><div class="para">
			Before we do the move, we use our first <code class="command">msat</code> command. We need to save the above set of RPM's in a directory to be able to calculate the repository metadata later! We must do it here: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mkdir registration</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_wr_sc_rpms.py -l con-tools-centos-x86_64-server-5 -e .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd con-tools-centos-x86_64-server-5</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mv rhn-check-1.9.10-1.el5.noarch.rpm rhn-setup-* rhn-client-tools-1.9.10-1.el5.noarch.rpm rhnlib-2.5.55-1.el5.noarch.rpm rhnsd-5.0.9-1.el5.x86_64.rpm yum-rhn-plugin-1.9.4-1.el5.noarch.rpm ../registration/</code></strong></pre>

		</div><div class="para">
			Moving the RPM's means: delete them from the <span class="bold bold"><strong>con-tools-centos-x86_64-server-5</strong></span> channel at the web interface and them place them in <span class="bold bold"><strong>centos-x86_64-server-5</strong></span> channel.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Channels</strong></span> → <span class="guimenuitem"><strong>Manage Software Channels</strong></span> → <span class="guimenuitem"><strong>con-tools-centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Packages</strong></span> → <span class="guimenuitem"><strong>List / Remove Packages</strong></span> → <span class="guimenuitem"><strong>Check: rhn-check-1.9.10-1.el5.noarch.rpm, rhn-client-tools-1.9.10-1.el5.noarch.rpm, rhnlib-2.5.55-1.el5.noarch.rpm, rhnsd-5.0.9-1.el5.x86_64.rpm, rhn-setup-1.9.10-1.el5.noarch.rpm, rhn-setup-gnome-1.9.10-1.el5.noarch, yum-rhn-plugin-1.9.4-1.el5.noarch.rpm, </strong></span> → <span class="guimenuitem"><strong>Confirm Removal</strong></span> → <span class="guimenuitem"><strong>Remove</strong></span>
		</div><div class="para">
			<span class="guimenuitem"><strong>Channels</strong></span> → <span class="guimenuitem"><strong>Manage Software Channels</strong></span> → <span class="guimenuitem"><strong>centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Packages</strong></span> → <span class="guimenuitem"><strong>Add</strong></span> → <span class="guimenuitem"><strong>Packages in no channels.</strong></span> → <span class="guimenuitem"><strong>Select All (should be 7 just removed)</strong></span> → <span class="guimenuitem"><strong>Confirm Addition</strong></span> → <span class="guimenuitem"><strong>Add Packages(s)</strong></span>
		</div></div><div class="section" id="spacewalk-sw_filling-kt"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-sw_filling-kt">1.6.4. Kickstartable tree</h3></div></div></div><div class="para">
			After filling the software channels, we need to create a kickstartable tree. A <span class="bold bold"><strong>kickstartable tree</strong></span> is the software from which we can start the OS installation. It is created on the Spacewalk server and on the web interface. We start with the Spacewalk server part.
		</div><div class="para">
			The part on the Spacewalk server consists of the RPM's, images and the repository metadata. A standard yum repository is a directory in which one finds the RPM's and the metadata of the repository. The metadata is calculated with the <code class="command">createrepo</code> command.
		</div><div class="para">
			Since the Satellite server stores the RPM's in its own way, it is not possible to calculate the repodata with <code class="command">createrepo</code> in the normal way. We tackle this problem by using the CentOS DVD and the <code class="filename">/root/registration</code> directory. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mkdir -p /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mount | grep CentOS-5.8-x86_64-bin-DVD-1of2.iso</code></strong>
.. not mounted ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mount -o loop /root/CentOS-5.8-x86_64-bin-DVD-1of2.iso /var/www/html/pub/iso/1</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp -a /var/www/html/pub/iso/1/images .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp -a /var/www/html/pub/iso/1/isolinux .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp -a /var/www/html/pub/iso/1/repodata .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp repodata/comps.xml .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>createrepo -o /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8 -p --simple-md-filenames --no-database -s sha -g /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8/comps.xml --split /var/www/html/pub/iso/1/CentOS --split /var/www/html/pub/iso/2/CentOS /root/registration</code></strong>
.. takes about 2 minutes ..
</pre>

		</div><div class="para">
			The next thing we need to do, is to create the kickstartable tree on the Web interface by defining a kickstart distribution.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>Kickstart</strong></span> → <span class="guimenuitem"><strong>Distributions</strong></span> → <span class="guimenuitem"><strong>create new distribution</strong></span> → <span class="guimenuitem"><strong>Distribution Label: ks-centos-x86_64-server-5u8</strong></span> → <span class="guimenuitem"><strong>Tree Path: /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8</strong></span> → <span class="guimenuitem"><strong>Base Channel: centos-x86_64-server-5</strong></span> → <span class="guimenuitem"><strong>Installer Generation: Red Hat Enterprise Linux 5</strong></span>+<span class="guibutton"><strong>Create Kickstart Distribution</strong></span>
		</div><div class="para">
			Make sure to set the <span class="bold bold"><strong>Variables</strong></span> correctly. <span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>Kickstart</strong></span> → <span class="guimenuitem"><strong>Distributions</strong></span> → <span class="guimenuitem"><strong>ks-centos-x86_64-server-5u8</strong></span> → <span class="guimenuitem"><strong>Variables</strong></span> → <span class="guimenuitem"><strong>media_path=/ks/dist/org/1/ks-centos-x86_64-server-5u8</strong></span> → <span class="guimenuitem"><strong>org=1</strong></span>+<span class="guibutton"><strong>Update Variables</strong></span>
		</div><div class="para">
			Next, we install the public GPG keys, needed for RPM verification. We download them to the Spacewalk server and also copy them to our local PC on which we run the web browser to the Spacewalk web interface. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /etc/pki/rpm-gpg</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget http://vault.centos.org/5.8/os/x86_64/RPM-GPG-KEY-CentOS-5</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk-2012</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>wget http://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-5</code></strong></pre>
			 Next we dump them to stdout so that we can copy them to our local Linux PC: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /etc/pki/rpm-gpg</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat RPM-GPG-KEY-CentOS-5</code></strong>
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.2.6 (GNU/Linux)

mQGiBEWfB6MRBACrnYW6yKMT+MwJlCIhoyTxGf3mAxmnAiDEy6HcYN8rivssVTJk
CFtQBlBOpLV/OW2YtKrCO2xHn46eNfnMri8FGT8g+9JF3MUVi7kiV1He4iJynHXB
+F2ZqIvHf3IaUj1ys+p8TK64FDFxDQDrGQfIsD/+pkSGx53/877IrvdwjwCguQcr
Ioip5TH0Fj0OLUY4asYVZH8EAIqFHEqsY+9ziP+2R3/FyxSllKkjwcMLrBug+cYO
LYDD6eQXE9Mq8XKGFDj9ZB/0+JzK/XQeStheeFG75q3noq5oCPVFO4czuKErIRAB
qKbDBhaTj3JhOgM12XsUYn+rI6NeMV2ZogoQCC2tWmDETfRpYp2moo53NuFWHbAy
XjETA/sHEeQT9huHzdi/lebNBj0L8nBGfLN1nSRP1GtvagBvkR4RZ6DTQyl0UzOJ
RA3ywWlrL9IV9mrpb1Fmn60l2jTMMCc7J6LacmPK906N+FcN/Docj1M4s/4CNanQ
NhzcFhAFtQL56SNyLTCk1XzhssGZ/jwGnNbU/aaj4wOj0Uef5LRGQ2VudE9TLTUg
S2V5IChDZW50T1MgNSBPZmZpY2lhbCBTaWduaW5nIEtleSkgPGNlbnRvcy01LWtl
eUBjZW50b3Mub3JnPohkBBMRAgAkBQJFnwekAhsDBQkSzAMABgsJCAcDAgMVAgMD
FgIBAh4BAheAAAoJEKikR9zoViiXKlEAmwSoZDvZo+WChcg3s/SpNoWCKhMAAJwI
E2aXpZVrpsQnInUQWwkdrTiL5YhMBBMRAgAMBQJFnwiSBYMSzAIRAAoJEDjCFhY5
bKCk0hAAn134bIx3wSbq58E6P6U5RT7Z2Zx4AJ9VxnVkoGHkVIgSdsxHUgRjo27N
F7kBDQRFnwezEAQA/HnJ5yiozwgtf6jt+kii8iua+WnjqBKomPHOQ8moxbWdv5Ks
4e1DPhzRqxhshjmub4SuJ93sgMSAF2ayC9t51mSJV33KfzPF2gIahcMqfABe/2hJ
aMzcQZHrGJCEX6ek8l8SFKou7vICzyajRSIK8gxWKBuQknP/9LKsoczV+xsAAwUD
/idXPkk4vRRHsCwc6I23fdI0ur52bzEqHiAIswNfO521YgLk2W1xyCLc2aYjc8Ni
nrMX1tCnEx0/gK7ICyJoWH1Vc7//79sWFtX2EaTO+Q07xjFX4E66WxJlCo9lOjos
Vk5qc7R+xzLDoLGFtbzaTRQFzf6yr7QTu+BebWLoPwNTiE8EGBECAA8FAkWfB7MC
GwwFCRLMAwAACgkQqKRH3OhWKJfvvACfbsF1WK193zM7vSc4uq51XsceLwgAoI0/
9GxdNhGQEAweSlQfhPa3yYXH
=o/Mx
-----END PGP PUBLIC KEY BLOCK-----

localpc <strong class="userinput"><code>cat &gt; /tmp/RPM-GPG-KEY-CentOS-5</code></strong>
.. the base64 encoded key from above ..

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat RPM-GPG-KEY-spacewalk-2012</code></strong>
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v2.0.18 (GNU/Linux)

mQGiBE9V9U0RBADjRxY1+Ng5gzaAj2LYHNwXHzyH65p+jL80+2vkf6WCNvewa+zK
SY8JH3syZMhjGi/vW3TcDy5KVqiXS2rpMJS6zCBrOJbtcFdV3VvbsPd7hK9COlph
NUx5RSIIwZRg1wyEjgeuYOSLuIhqNsI+fjXk+uzletSLtIYUF3TUq5jCvwCg4XQ/
/RPOFH6KiHfIx8QUZmvT0IkD/ip7pOn5uSPNiIbj3X5RYbz8PB/z5OuoenfzYn4R
WDBXZBlWMaPJCupAYwdP9IsiXo8WvbyXPHgG91P/MStrCgOffACNhuMus1FwqlCQ
VFuKENB6f2g4DY9Mow6bKYgsSEy0qnEF5I2M+BqjApO0oznxzcyJ4coXQdA9/oCP
vYU5A/9FTgukU1p/CbNJIhT4iH+vE6cKFGAtzhwwQxMdnii8ctcKiCYgiimuU7OG
rcPKR1xsRX/sc6XZYJeLmc1Lt7Btkdl36RY5BgesVJkUNyKh8+7MllW5PvVFvtGv
vvvrRVK+mJYxdBU0/Sqc94ZgBW6vdvRwHgXhpKor6NsCfJUWvLQmU3BhY2V3YWxr
IDxzcGFjZXdhbGstZGV2ZWxAcmVkaGF0LmNvbT6IaAQTEQIAKAUCT1X1TQIbAwUJ
BKKGAAYLCQgHAwIGFQgCCQoLBBYCAwECHgECF4AACgkQDmRvaIY6hT16sQCfVuJv
KnSWzWXo0ek16NrqUSgdTYIAn3Q6Jc3GAzkx/JgmA6T6pLxp2f1uiEYEEBECAAYF
Ak9V/egACgkQ7WNTebOJITK97gCfdeNye+OKidB2huEfzxP37ZkdfSIAniAA4NMY
QsmjPPkUJSVguO7GbdXSuQINBE9V9U0QCACBbWXaPP5RqAIGnr9LeFbSYpWs2SnL
KPv0qylyOGMc3GwmpJjeuz1d4y5fHIQxsQl7+RLIxOARcYH1QL6gHN450JcpYzau
/Lj1ArsAP/QK/J8YSmjG0E0rU8sYRWIu7jzISgfMAs3c3wNvOMUCiXtXFV6crm9q
3kbrZTedWLkShSLDAp5394hmBbRicWnc9h4LwBKp+BBtsvJFfDydc8IJUGZLZNZT
RayYWC5VMDe1xmOZXhNpDxfNrjhUUI6E6qWwdinmzifhP6z6YNtRON1yWSLBwtcr
LghyEJlilijIbCDgZ8Nvtqy/c2ypcLxMrXy70x05fjcQK2KIuLI58GGDAAMFB/9n
m5YLj4S4XxF8/xP7givuPq37C7NYLOuzFKKx6xxqngV8TNGDVU2zv/lieh2ussXE
XF/S9Du2abpXYgxsxwFJNMMKXUam03ExFSUvUAco6nmxySzvtgudCZ/9HqLhbNVu
RpyUNA/g9vkYK6KVdxAeHUdu/EwfSL/pCEc11Dw1jYqbihktlTQPcizsSPG4Y7jh
OUrKgxJop9DovUGzuUSl/7zYr4W7TiGV3my0f7U3qkpVT0bQoMnw8TxCZj4x3umo
F4klakeGX0FK4vwV5hDq32Q6vWN804F34Vi3WsaUT9G1E3H7/s/OQgWLOm16mgjR
pN1E79kYwtPMCAz0pYMciE8EGBECAA8FAk9V9U0CGwwFCQSihgAACgkQDmRvaIY6
hT3D2ACfYsiYS39rFdR1aBHviE0hVm9MWxUAnR3Ua92zW/0UoJ7TgxR0Dxzta37z
=yqYQ
-----END PGP PUBLIC KEY BLOCK-----

localpc <strong class="userinput"><code>cat &gt; /tmp/RPM-GPG-KEY-spacewalk-2012</code></strong>
.. the base64 encoded key from above ..

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat RPM-GPG-KEY-EPEL-5</code></strong>
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.2.6 (GNU/Linux)

mQGiBEXopTIRBACZDBMOoFOakAjaxw1LXjeSvh/kmE35fU1rXfM7T0AV31NATCLF
l5CQiNDA4oWreDThg2Bf6+LIVTsGQb1V+XXuLak4Em5yTYwMTVB//4/nMxQEbpl/
QB2XwlJ7EQ0vW+kiPDz/7pHJz1p1jADzd9sQQicMtzysS4qT2i5A23j0VwCg1PB/
lpYqo0ZhWTrevxKMa1n34FcD/REavj0hSLQFTaKNLHRotRTF8V0BajjSaTkUT4uk
/RTaZ8Kr1mTosVtosqmdIAA2XHxi8ZLiVPPSezJjfElsSqOAxEKPL0djfpp2wrTm
l/1iVnX+PZH5DRKCbjdCMLDJhYap7YUhcPsMGSeUKrwmBCBJUPc6DhjFvyhA9IMl
1T0+A/9SKTv94ToP/JYoCTHTgnG5MoVNafisfe0wojP2mWU4gRk8X4dNGKMj6lic
vM6gne3hESyjcqZSmr7yELPPGhI9MNauJ6Ob8cTR2T12Fmv9w03DD3MnBstR6vhP
QcqZKhc5SJYYY7oVfxlSOfF4xfwcHQKoD5TOKwIAQ6T8jyFpKbQkRmVkb3JhIEVQ
RUwgPGVwZWxAZmVkb3JhcHJvamVjdC5vcmc+iGQEExECACQFAkXopTICGwMFCRLM
AwAGCwkIBwMCAxUCAwMWAgECHgECF4AACgkQEZzANiF1IfabmQCgzvE60MnHSOBa
ZXXF7uU2Vzu8EOkAoKg9h+j0NuNom6WUYZyJQt4zc5seuQINBEXopTYQCADapnR/
blrJ8FhlgNPl0X9S3JE/kygPbNXIqne4XBVYisVp0uzNCRUxNZq30MpY027JCs2J
nL2fMpwvx33f0phU029vrIZKA3CmnnwVsjcWfMJOVPBmVN7m5bGU68F+PdRIcDsl
PMOWRLkTBZOGolLgIbM4719fqA8etewILrX6uPvRDwywV7/sPCFpRcfNNBUY+Zx3
5bf4fnkaCKxgXgQS3AT+hGYhlzIqQVTkGNveHTnt4SSzgAqR9sSwQwqvEfVtYNeS
w5rDguLG41HQm1Hojv59HNYjH6F/S1rClZi21bLgZbKpCFX76qPt8CTw+iQLBPPd
yoOGHfzyp7nsfhUrAAMFB/9/H9Gpk822ZpBexQW4y3LGFo9ZSnmu+ueOZPU3SqDA
DW1ovZdYzGuJTGGM9oMl6bL8eZrcUBBOFaWge5wZczIE3hx2exEOkDdvq+MUDVD1
axmN45q/7h1NYRp5GQL2ZsoV4g9U2gMdzHOFtZCER6PP9ErVlfJpgBUCdSL93V4H
Sgpkk7znmTOklbCM6l/G/A6q4sCRqfzHwVSTiruyTBiU9lfROsAl8fjIq2OzWJ2T
P9sadBe1llUYaow7txYSUxssW+89avct35gIyrBbof5M+CBXyAOUaSWmpM2eub24
0qbqiSr/Y6Om0t6vSzR8gRk7g+1H6IE0Tt1IJCvCAMimiE8EGBECAA8FAkXopTYC
GwwFCRLMAwAACgkQEZzANiF1IfZQYgCgiZHCv4xb+sTHCn/otc1Ovvi/OgMAnRXY
bbsLFWOfmzAnNIGvFRWy+YHi
=MMNL
-----END PGP PUBLIC KEY BLOCK-----

localpc <strong class="userinput"><code>cat &gt; /tmp/RPM-GPG-KEY-EPEL-5</code></strong>
.. the base64 encoded key from above ..

</pre>

		</div><div class="para">
			Next, we need to upload the public GPG keys to the Spacewalk server, via the web interface.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>Kickstart</strong></span> → <span class="guimenuitem"><strong>GPG and SSL Keys</strong></span> → <span class="guimenuitem"><strong>create new stored key/cert</strong></span> <div class="table" id="tabl-msat-guide-Kickstartable_tree-Create_CentOS_5_GPGSSL_Key"><h6>Table 1.11. Create CentOS 5 GPG/SSL Key</h6><div class="table-contents"><table summary="Create CentOS 5 GPG/SSL Key" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Description:</strong></span>
							</td><td align="left" valign="top">
								RPM-GPG-KEY-CentOS-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Type:</strong></span>
							</td><td align="left" valign="top">
								GPG
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Select file to upload:</strong></span>
							</td><td align="left" valign="top">
								<code class="filename">/tmp/RPM-GPG-KEY-CentOS-5</code>
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <div class="table" id="tabl-msat-guide-Kickstartable_tree-Create_Spacewalk_2012_GPGSSL_Key"><h6>Table 1.12. Create Spacewalk 2012 GPG/SSL Key</h6><div class="table-contents"><table summary="Create Spacewalk 2012 GPG/SSL Key" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Description:</strong></span>
							</td><td align="left" valign="top">
								RPM-GPG-KEY-spacewalk-2012
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Type:</strong></span>
							</td><td align="left" valign="top">
								GPG
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Select file to upload:</strong></span>
							</td><td align="left" valign="top">
								<code class="filename">/tmp/RPM-GPG-KEY-spacewalk-2012</code>
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <div class="table" id="tabl-msat-guide-Kickstartable_tree-Create_EPEL_5_GPGSSL_Key"><h6>Table 1.13. Create EPEL 5 GPG/SSL Key</h6><div class="table-contents"><table summary="Create EPEL 5 GPG/SSL Key" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Description:</strong></span>
							</td><td align="left" valign="top">
								RPM-GPG-KEY-EPEL-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Type:</strong></span>
							</td><td align="left" valign="top">
								GPG
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Select file to upload:</strong></span>
							</td><td align="left" valign="top">
								<code class="filename">/tmp/RPM-GPG-KEY-EPEL-5</code>
							</td></tr></tbody></table></div></div><br class="table-break" />

		</div></div></div><div xml:lang="en-US" class="section" id="spacewalk-test" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-test">1.7. Test Spacewalk</h2></div></div></div><div class="table" id="tabl-msat-guide-Test_Spacewalk-Time_needed"><h6>Table 1.14. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Config channel
					</td><td align="left" valign="top">
						5 minutes
					</td></tr><tr><td align="left" valign="top">
						Activation key
					</td><td align="left" valign="top">
						5 minutes
					</td></tr><tr><td align="left" valign="top">
						Kickstart profile
					</td><td align="left" valign="top">
						20 minutes
					</td></tr><tr><td align="left" valign="top">
						Cobbler
					</td><td align="left" valign="top">
						5 minutes
					</td></tr><tr><td align="left" valign="top">
						Test installation
					</td><td align="left" valign="top">
						15 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		To test Spacewalk, we need the following items: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					A configuration file in a configuration channel.
				</div></li><li class="listitem"><div class="para">
					An activation key with at least one RPM and a link to the configuration channel.
				</div></li><li class="listitem"><div class="para">
					A kickstart profile with a link to the activation key and 1 post install script.
				</div></li><li class="listitem"><div class="para">
					A Cobbler system and the Cobbler boot ISO.
				</div></li><li class="listitem"><div class="para">
					The environment on the host to create a KVM virtual machine.
				</div></li></ul></div>

	</div><div class="section" id="spacewalk-test-cc"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-test-cc">1.7.1. Config Channel</h3></div></div></div><div class="para">
			Create the config channel. <span class="guimenuitem"><strong>Configuration</strong></span> → <span class="guimenuitem"><strong>Configuration Channels</strong></span> → <span class="guimenuitem"><strong>create new config channel</strong></span>
		</div><div class="para">
			<div class="table" id="tabl-msat-guide-Config_Channel-Config_Channel"><h6>Table 1.15. Config Channel</h6><div class="table-contents"><table summary="Config Channel" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Name:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Label:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Description:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr></tbody></table></div></div><br class="table-break" />

		</div><div class="para">
			Add a configuration file with: <span class="guimenuitem"><strong>Add Files</strong></span> → <span class="guimenuitem"><strong>Create File</strong></span>
		</div><div class="para">
			Now, add the following parameters: 
			<div class="table" id="tabl-msat-guide-Config_Channel-etcmotd"><h6>Table 1.16. <code class="filename">/etc/motd</code></h6><div class="table-contents"><table summary="/etc/motd" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Filename/Path:</strong></span>
							</td><td align="left" valign="top">
								/etc/motd
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>File Contents:</strong></span>
							</td><td align="left" valign="top">
								
<pre class="screen">
Welcome to test01.


</pre>

							</td></tr></tbody></table></div></div><br class="table-break" />
			 Click <span class="guibutton"><strong>Create Configuration File</strong></span>.
		</div></div><div class="section" id="spacewalk-test-ak"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-test-ak">1.7.2. Activation Key</h3></div></div></div><div class="para">
			The <span class="bold bold"><strong>test01</strong></span> config channel needs to be refered to by an activation key. We create it here.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>Activation Keys</strong></span> → <span class="guimenuitem"><strong>create new key</strong></span> <div class="table" id="tabl-msat-guide-Activation_Key-Activation_Key"><h6>Table 1.17. Activation Key</h6><div class="table-contents"><table summary="Activation Key" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Description:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Key:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Usage:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Base Channels:</strong></span>
							</td><td align="left" valign="top">
								centos-x86_64-server-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Add-On Entitlements:</strong></span>
							</td><td align="left" valign="top">
								Provisioning
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Universal Default:</strong></span>
							</td><td align="left" valign="top">
								&lt;unchecked&gt;
							</td></tr></tbody></table></div></div><br class="table-break" />
			 Click <span class="guibutton"><strong>Create Activation Key</strong></span>
		</div><div class="para">
			Make sure to also check <span class="bold bold"><strong>Configuration File Deployment</strong></span> since we want to deploy configuration file too.
		</div><div class="para">
			<span class="guimenuitem"><strong>Details</strong></span> → <span class="guimenuitem"><strong>Configuration File Deployment</strong></span> → <span class="guimenuitem"><strong>check</strong></span>+<span class="guibutton"><strong>Update Key</strong></span>
		</div><div class="para">
			Add an RPM package with: <span class="guimenuitem"><strong>Packages</strong></span> → <span class="guimenuitem"><strong>screen</strong></span>+<span class="guibutton"><strong>Update Key</strong></span>
		</div><div class="para">
			Link the configuration channel with <span class="guimenuitem"><strong>Configuration</strong></span> → <span class="guimenuitem"><strong>Subscribe to Channels</strong></span> → <span class="guimenuitem"><strong>test01</strong></span>+<span class="guibutton"><strong>Continue</strong></span>
		</div></div><div class="section" id="spacewalk-test-kp"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-test-kp">1.7.3. Kickstart Profile</h3></div></div></div><div class="para">
			To further determine how the system should be provisioned, we define the <span class="bold bold"><strong>test01</strong></span> kickstart profile. In it, we refer to the activation key.
		</div><div class="para">
			<span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>Kickstart</strong></span> → <span class="guimenuitem"><strong>Profiles</strong></span> → <span class="guimenuitem"><strong>create new kickstart profile</strong></span> <div class="table" id="tabl-msat-guide-Kickstart_Profile-Kickstart_Profile"><h6>Table 1.18. Kickstart Profile</h6><div class="table-contents"><table summary="Kickstart Profile" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Label:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Base Channel:</strong></span>
							</td><td align="left" valign="top">
								cnetos-x86_64-server-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Kickstartable Tree:</strong></span>
							</td><td align="left" valign="top">
								ks-centos-x86_64-server-5u8
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Base Channels:</strong></span>
							</td><td align="left" valign="top">
								centos-x86_64-server-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Virtualization Type:</strong></span>
							</td><td align="left" valign="top">
								None
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Next</strong></span>+<span class="guimenu"><strong>Next</strong></span> <div class="table" id="tabl-msat-guide-Kickstart_Profile-Root_password"><h6>Table 1.19. Root password</h6><div class="table-contents"><table summary="Root password" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>New Root Password:</strong></span>
							</td><td align="left" valign="top">
								redhat
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Verify New Root Password:</strong></span>
							</td><td align="left" valign="top">
								redhat
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Finish</strong></span>
		</div><div class="para">
			<div class="table" id="tabl-msat-guide-Kickstart_Profile-Kickstart_test01"><h6>Table 1.20. Kickstart: test01</h6><div class="table-contents"><table summary="Kickstart: test01" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Kickstart Label:</strong></span>
							</td><td align="left" valign="top">
								test01
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Operating System:</strong></span>
							</td><td align="left" valign="top">
								centos-x86_64_server-5
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Virtualization Type:</strong></span>
							</td><td align="left" valign="top">
								None
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Active:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Log custom post scripts:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Log custom pre scripts:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Preserve ks.cfg:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Organization Default Profile:</strong></span>
							</td><td align="left" valign="top">
								&lt;unchecked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Kernel Options:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Post Kernel Options:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Comments:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Update Kickstart</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>Advanced Options</strong></span>
		</div><div class="para">
			Note, some values need to be unchecked and cleared! Really, only the values presented here must be present. 
			<div class="table" id="tabl-msat-guide-Kickstart_Profile-Kickstart_test01_System_Details"><h6>Table 1.21. Kickstart: test01, System Details</h6><div class="table-contents"><table summary="Kickstart: test01, System Details" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>auth:</strong></span>
							</td><td align="left" valign="top">
								--enablemd5 --enableshadow
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>bootloader:</strong></span>
							</td><td align="left" valign="top">
								--location mbr
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>clearpart:</strong></span>
							</td><td align="left" valign="top">
								--all
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>firewall:</strong></span>
							</td><td align="left" valign="top">
								--enabled
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>install:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>key:</strong></span>
							</td><td align="left" valign="top">
								--skip
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>keyboard:</strong></span>
							</td><td align="left" valign="top">
								us
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>lang:</strong></span>
							</td><td align="left" valign="top">
								en_US
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>reboot:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>rootpw:</strong></span>
							</td><td align="left" valign="top">
								$1$RsnjsSwK$KbtWynXvaUGZ0ZZh0qXQu/
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>selinux:</strong></span>
							</td><td align="left" valign="top">
								--enforcing
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>skipx:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>text:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>timezone:</strong></span>
							</td><td align="left" valign="top">
								--utc Europe/Amsterdam
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>url:</strong></span>
							</td><td align="left" valign="top">
								--url /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>zerombr:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Update Kickstart</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>System Details</strong></span>+<span class="guimenu"><strong>Details</strong></span>
		</div><div class="para">
			We only show the checked options and their value! 
			<div class="table" id="tabl-msat-guide-Kickstart_Profile-Kickstart_test01_Advanced_Options"><h6>Table 1.22. Kickstart: test01, Advanced Options</h6><div class="table-contents"><table summary="Kickstart: test01, Advanced Options" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>SeLinux:</strong></span>
							</td><td align="left" valign="top">
								Enforcing
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Enable Spacewalk Configuration Management:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Enable Spacewalk Remote Commands:</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Spacewalk Profile:</strong></span>
							</td><td align="left" valign="top">
								Re-connect to the existing system profile. Do not create a new system profile.
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>New Root password:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Verify New Root password:</strong></span>
							</td><td align="left" valign="top">
								&lt;empty&gt;
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Update System Details</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>System Details</strong></span>+<span class="guimenu"><strong>Partitioning</strong></span>
		</div><div class="para">
			Partition Details: 
<pre class="screen">
part /boot --fstype=ext3 --size=200
part pv.01 --size=1 --grow
part swap --size=512
volgroup myvg pv.01
logvol / --vgname=myvg --name=rootvol --size=1 --grow
</pre>
			 <span class="guimenu"><strong>Update Partitions</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>System Details</strong></span>+<span class="guimenu"><strong>GPG &amp; SSL</strong></span>+<span class="guimenu"><strong>Select All</strong></span>+<span class="guimenu"><strong>Update keys</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>Activation Keys</strong></span>+<span class="guimenu"><strong>Select All</strong></span>+<span class="guimenu"><strong>Update Activation Keys</strong></span>
		</div><div class="para">
			<span class="guimenu"><strong>Scripts</strong></span>+<span class="guimenu"><strong>add new kickstart script</strong></span> <div class="table" id="tabl-msat-guide-Kickstart_Profile-Kickstart_Script"><h6>Table 1.23. Kickstart: Script</h6><div class="table-contents"><table summary="Kickstart: Script" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
								parameter
							</th><th align="left" valign="top">
								value
							</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Script Name</strong></span>
							</td><td align="left" valign="top">
								1
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Script Contents</strong></span>
							</td><td align="left" valign="top">
								
<pre class="screen">
/bin/rm /etc/yum.repos.d/CentOS-*.repo
</pre>

							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Script Execution Time</strong></span>
							</td><td align="left" valign="top">
								Post Script
							</td></tr><tr><td align="left" valign="top">
								<span class="bold bold"><strong>Template</strong></span>
							</td><td align="left" valign="top">
								&lt;checked&gt;
							</td></tr></tbody></table></div></div><br class="table-break" />
			 <span class="guimenu"><strong>Update Kickstart</strong></span>
		</div></div><div class="section" id="spacewalk-test-cob"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-test-cob">1.7.4. Cobbler</h3></div></div></div><div class="para">
			Since we want to start our bare metal provisioning with a boot ISO, we need to create a system in Cobbler. This task can be accomplished by using a script. We present it here: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat /root/cobbler-dmm01.sh</code></strong>
#!/bin/bash
#
# SCRIPT
#   cobbler-dmm01.sh
# DESCRIPTION
#   This script should be run on the Spacewalk server:
#   # ./cobbler-dmm01.sh
#
#   IP details
#
#   Host       Prod            Cluster        ILO
#   dmm01      192.168.5.100   -              -
#
#   Subnets:
#   192.168.5.0/24  gw: 192.168.5.1
#
#   DNS servers:
#   * 192.168.5.11 (d19sw1.dmsat1.org)
#
# ARGUMENTS
#   None.
# RETURN
#   Value from cobbler command. See cobbler man page.
# DEPENDENCIES
#   The profile should not yet exist in cobbler. If it does,
#   remove it with:
#   sudo cobbler system remove \
#     --name=SpacewalkDefaultOrganization_kvm_dmm01
#   Adding an existing profile results in a clear warning
#   from cobbler. No harm is done.
# FAILURE
# AUTHORS
#   Date strings made with 'date +"\%Y-\%m-\%d \%H:\%M"'.
#   Allard Berends (AB), 2013-05-02 19:18
# HISTORY
# LICENSE
#   Copyright (C) 2013 Allard Berends
# 
#   cobbler-dmm01.sh is free software; you can
#   redistribute it and/or modify it under the terms of the
#   GNU General Public License as published by the Free
#   Software Foundation; either version 3 of the License, or
#   (at your option) any later version.
#
#   cobbler-dmm01.sh is distributed in the hope
#   that it will be useful, but WITHOUT ANY WARRANTY;
#   without even the implied warranty of MERCHANTABILITY or
#   FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
#   Public License for more details.
#
#   You should have received a copy of the GNU General
#   Public License along with this program; if not, write to
#   the Free Software Foundation, Inc., 59 Temple Place -
#   Suite 330, Boston, MA 02111-1307, USA.
# DESIGN
#

COBBLER="sudo cobbler"
# AB: non base Spacewalk organizations have orgnum != 1
#ORGNUM=$(msat_ls_org.py)
ORGNUM=1

########## PARAMETERS TO EDIT ##########
NAME="dmm01"
OWNERS="example"
MACH="kvm"
PROFILE="test01"
ORG="SpacewalkDefaultOrganization"
COMMENT="empty"
GATEWAY=192.168.5.1
NAMESERVERS="192.168.5.11"
NAMESERVERS_SEARCH="dmsat1.org"
HOSTNAME=${NAME}.${NAMESERVERS_SEARCH}
PROD_IP=192.168.5.100
PROD_SUBNET=255.255.255.0
PROD_DNS_NAME=${HOSTNAME}
MAC_ETH0=52:54:00:a8:05:64

########## START SCRIPT ##########
$COBBLER system add \
  --name=${ORG}_${MACH}_${NAME} \
  --owners=${OWNERS} \
  --profile=${PROFILE}:${ORGNUM}:${ORG} \
  --kopts="ksdevice=${MAC_ETH0} ip=${PROD_IP} netmask=${PROD_SUBNET}" \
  --netboot-enabled=0 \
  --comment=${COMMENT} \
  --power-type=ipmitool \
  --hostname=${HOSTNAME} \
  --gateway=${GATEWAY} \
  --name-servers="$NAMESERVERS" \
  --name-servers-search=$NAMESERVERS_SEARCH \
  --redhat-management-key='&lt;&lt;inherit&gt;&gt;' \
  --redhat-management-server='&lt;&lt;inherit&gt;&gt;'
  #--uid=UID
  #--image=IMAGE
  #--kopts-post=KOPTS_POST
  #--ksmeta=KSMETA
  #--kickstart=KICKSTART
  #--depth=DEPTH
  #--server=SERVER
  #--virt-path=VIRT_PATH
  #--virt-type=VIRT_TYPE
  #--virt-cpus=VIRT_CPUS
  #--virt-file-size=VIRT_FILE_SIZE
  #--virt-ram=VIRT_RAM
  #--virt-auto-boot=VIRT_AUTO_BOOT
  #--ctime=CTIME
  #--mtime=MTIME
  #--power-address=POWER_ADDRESS
  #--power-user=POWER_USER
  #--power-pass=POWER_PASS
  #--power-id=POWER_ID
  #--ipv6-default-device=IPV6_DEFAULT_DEVICE
  #--ipv6-autoconfiguration=IPV6_AUTOCONFIGURATION
  #--mgmt-classes=MGMT_CLASSES
  #--template-files=TEMPLATE_FILES
  #--template-remote-kickstarts=TEMPLATE_REMOTE_KICKSTARTS
  #--clobber
  #--template-files=TEMPLATE_FILES
  #--in-place

/usr/bin/cobbler system edit \
  --name=${ORG}_${MACH}_${NAME} \
  --mac-address=${MAC_ETH0} \
  --ip-address=${PROD_IP} \
  --static=1 \
  --subnet=${PROD_SUBNET} \
  --dns-name=${PROD_DNS_NAME} \
  --interface=eth0
  #--mtu=MTU
  #--dhcp-tag=DHCP_TAG
  #--static-routes=STATIC_ROUTES
  #--virt-bridge=VIRT_BRIDGE
  #--ipv6-address=IPV6_ADDRESS
  #--ipv6-secondaries=IPV6_SECONDARIES
  #--ipv6-mtu=IPV6_MTU
  #--ipv6-static-routes=IPV6_STATIC_ROUTES
  #--ipv6-default-gateway=IPV6_DEFAULT_GATEWAY
</pre>

		</div><div class="para">
			We run the above script and verify that the system is known in Cobbler: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>chmod u+x cobbler-dmm01.sh</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>./cobbler-dmm01.sh</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler system list | grep dmm01</code></strong>
   SpacewalkDefaultOrganization_kvm_dmm01
</pre>

		</div><div class="para">
			We create the Cobbler boot ISO with: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler get-loaders</code></strong>
task started: 2013-05-02_155133_get_loaders
task started (id=Download Bootloader Content, time=Thu May  2 15:51:33 2013)
downloading http://dgoodwin.fedorapeople.org/loaders/README to /var/lib/cobbler/loaders/README
downloading http://dgoodwin.fedorapeople.org/loaders/COPYING.elilo to /var/lib/cobbler/loaders/COPYING.elilo
downloading http://dgoodwin.fedorapeople.org/loaders/COPYING.yaboot to /var/lib/cobbler/loaders/COPYING.yaboot
downloading http://dgoodwin.fedorapeople.org/loaders/COPYING.syslinux to /var/lib/cobbler/loaders/COPYING.syslinux
downloading http://dgoodwin.fedorapeople.org/loaders/elilo-3.8-ia64.efi to /var/lib/cobbler/loaders/elilo-ia64.efi
downloading http://dgoodwin.fedorapeople.org/loaders/yaboot-1.3.14-12 to /var/lib/cobbler/loaders/yaboot
downloading http://dgoodwin.fedorapeople.org/loaders/pxelinux.0-3.61 to /var/lib/cobbler/loaders/pxelinux.0
downloading http://dgoodwin.fedorapeople.org/loaders/menu.c32-3.61 to /var/lib/cobbler/loaders/menu.c32
downloading http://dgoodwin.fedorapeople.org/loaders/grub-0.97-x86.efi to /var/lib/cobbler/loaders/grub-x86.efi
downloading http://dgoodwin.fedorapeople.org/loaders/grub-0.97-x86_64.efi to /var/lib/cobbler/loaders/grub-x86_64.efi
*** TASK COMPLETE ***
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>yum install syslinux</code></strong>
.. might already be installed ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd /var/lib/cobbler/loaders</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp /usr/share/syslinux/menu.c32 .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cp /usr/share/syslinux/vesamenu.c32 .</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>mkdir -p /var/www/cobbler/pub/example</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler buildiso --iso=/var/www/cobbler/pub/example/centos5u8-test01-kvm.iso --profiles="" --systems="SpacewalkDefaultOrganization_kvm_dmm01" --tempdir=/tmp</code></strong>
task started: 2013-05-02_155717_buildiso
task started (id=Build Iso, time=Thu May  2 15:57:17 2013)
using/creating buildisodir: /tmp/buildiso
building tree for isolinux
copying miscellaneous files
copying kernels and initrds for profiles
copying kernels and initrds for systems
generating a isolinux.cfg
generating profile list
generating system list
 - ksdevice 52:54:00:a8:05:64 set for system SpacewalkDefaultOrganization_kvm_dmm01
append line length is greater than 254 chars: (276 chars)
done writing config
running: mkisofs -o /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso -r -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -V Cobbler\ Install -R -J -T /tmp/buildiso
received on stdout: 
received on stderr: I: -input-charset not specified, using utf-8 (detected in locale settings)
Size of boot image is 4 sectors -&gt; No emulation
 68.62% done, estimate finish Thu May  2 15:57:18 2013
Total translation table size: 4029
Total rockridge attributes bytes: 1320
Total directory bytes: 4096
Path table size(bytes): 40
Max brk space used 1c000
7301 extents written (14 MB)

ISO build complete
You may wish to delete: /tmp/buildiso
The output file is: /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso
*** TASK COMPLETE ***
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>ls -lh /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso</code></strong>
-rw-r--r--. 1 root root 15M May  2 15:57 /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>scp /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso root@192.168.5.1:/tmp</code></strong></pre>

		</div></div><div class="section" id="spacewalk-test-kvm"><div class="titlepage"><div><div><h3 class="title" id="spacewalk-test-kvm">1.7.5. KVM installation</h3></div></div></div><div class="para">
			On the host machine we need to create storage space for our test machine: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>pvs</code></strong>
  PV         VG        Fmt  Attr PSize   PFree
  /dev/sda3  vg_server lvm2 a--  931.00g      0
  /dev/sdb   b         lvm2 a--  931.51g 638.54g
  /dev/sdc   c         lvm2 a--  931.51g 931.51g
  /dev/sdd   d         lvm2 a--  931.51g 931.51g
  /dev/sde   e         lvm2 a--  931.51g 931.51g
  /dev/sdf   f         lvm2 a--  931.51g 931.51g

<code class="prompt">server#</code> <strong class="userinput"><code>pvs -o +vg_extent_size /dev/sde</code></strong>
  PV         VG   Fmt  Attr PSize   PFree   Ext
  /dev/sde   e    lvm2 a--  931.51g 931.51g 4.00m

<code class="prompt">server#</code> <strong class="userinput"><code>lvcreate -n mm -l $((25 * 10 * 5)) e</code></strong>
  Logical volume "mm" created

</pre>

		</div><div class="para">
			Explanation of the parameters in the <code class="command">virt-install</code> command: 
			<div class="itemizedlist"><ul><li class="listitem"><div class="para">
						dmm01, d (development), mm (model machine), 01 (first).
					</div></li><li class="listitem"><div class="para">
						mac=52:54:00:a8:05:64, 192.168.5.100 -&gt; 00:a8:05:64, the 52:54:00 is obligatory by libvirt definition.
					</div></li></ul></div>
			 To make it easy to verify the <code class="command">virt-install</code> options in the <span class="emphasis"><em>virt-install man page</em></span>, we specify them in the same order as they appear in the man page.
		</div><div class="para">
			The installation is started with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virt-install \</code></strong>
  <strong class="userinput"><code>--connect qemu:///system \</code></strong>
  <strong class="userinput"><code>--name=dmm01 \</code></strong>
  <strong class="userinput"><code>--ram=512 \</code></strong>
  <strong class="userinput"><code>--arch=x86_64 \</code></strong>
  <strong class="userinput"><code>--description="Provisioning test machine" \</code></strong>
  <strong class="userinput"><code>--cdrom /tmp/centos5u8-test01-kvm.iso \</code></strong>
  <strong class="userinput"><code>--os-type=linux \</code></strong>
  <strong class="userinput"><code>--os-variant=rhel5.4 \</code></strong>
  <strong class="userinput"><code>--disk path=/dev/e/mm,device=disk,bus=scsi \</code></strong>
  <strong class="userinput"><code>--network=network=dmsat1,mac=52:54:00:a8:05:64 \</code></strong>
  <strong class="userinput"><code>--graphics vnc \</code></strong>
  <strong class="userinput"><code>--hvm \</code></strong>
  <strong class="userinput"><code>--autostart</code></strong>
.. output skipped, about 10 minutes ..
</pre>
			 Select <span class="bold bold"><strong>SpacewalkDefaultOrganization_kvm_dmm01</strong></span> and press <span class="keycap"><strong>Enter</strong></span>.
		</div><div class="para">
			To check on the installed system if everything is working fine, one does: 
<pre class="screen">
<code class="prompt">dmm01#</code> rhncfg-client list
Using server name d19sw1.dmsat1.org
DoFoS   Config Channel   File
F           test01     /etc/motd
<code class="prompt">dmm01#</code> yum repolist
Loaded plugins: fastestmirror, rhnplugin, security
This system is receiving updates from RHN Classic or RHN Satellite.
Loading mirror speeds from cached hostfile
repo id                              repo name                            status
centos-x86_64-server-5               centos-x86_64-server-5               3,602
con-tools-centos-x86_64-server-5     con-tools-centos-x86_64-server-5        15
repolist: 3,617
</pre>

		</div></div></div><div xml:lang="en-US" class="section" id="spacewalk-selinux" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-selinux">1.8. Switching on SELinux</h2></div></div></div><div class="table" id="tabl-msat-guide-Switching_on_SELinux-Time_needed"><h6>Table 1.24. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Create custom policy
					</td><td align="left" valign="top">
						5 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		In the last section, we have installed, registered and configured a system via Spacewalk. Meaning that all SELinux denials should now be logged in <code class="filename">/var/log/audit/audit.log</code>. In the standard logging, <code class="filename">/var/log/messages</code>, one should see <span class="bold bold"><strong>sealert</strong></span> messages. Running one message gives us the recipe to create a custom policy to make <span class="application"><strong>cobbler</strong></span> run under SELinux.
	</div><div class="para">
		First we detect the last <span class="bold bold"><strong>sealert</strong></span> message: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep sealert /var/log/messages</code></strong>
.
.
May 10 15:34:57 d19sw1 setroubleshoot: SELinux is preventing /usr/bin/python2.7 from link access on the file vmlinuz. For complete SELinux messages. run sealert -l 6cc70fe5-a8b9-4320-bf39-cac3b8c10656
.
.
May 10 19:48:07 d19sw1 setroubleshoot: SELinux is preventing /usr/sbin/httpd from search access on the directory /var/log/cobbler. For complete SELinux messages. run sealert -l 4fd01220-fd4c-4d89-9862-fe9d8e4397c0
.
.
</pre>
		 As the messages suggest, we run <code class="command">sealert</code>: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sealert -l 6cc70fe5-a8b9-4320-bf39-cac3b8c10656</code></strong>
.
.
# grep cobblerd /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp
.
.
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep cobblerd /var/log/audit/audit.log | audit2allow -M mycbpol</code></strong>
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i mycbpol.pp

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>semodule -i mycbpol.pp</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sealert -l 4fd01220-fd4c-4d89-9862-fe9d8e4397c0</code></strong>
.
.
# grep /usr/sbin/httpd /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp
.
.
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep /usr/sbin/httpd /var/log/audit/audit.log | audit2allow -M myhdpol</code></strong>
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i myhdpol.pp

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>semodule -i myhdpol.pp</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>vim /etc/selinux/config</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep ^SELINUX= /etc/selinux/config</code></strong>
SELINUX=enforcing
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>setenforce 1</code></strong></pre>

	</div><div class="para">
		To verify if SELinux is now behaving correctly, we have to recreate the Spacewalk content with respect to the <span class="bold bold"><strong>test01</strong></span> profile. Furthermore, we need to unregister the system and do the installation again.
	</div><div class="para">
		We demonstrate here how to unregister the system from the Spacewalk server. In the section <a class="xref" href="#spacewalk-msat_demo">Section 1.9, “MSAT Demo”</a>, we show how to easily fill the Spacewalk with the <span class="bold bold"><strong>test01</strong></span> profile and attached items.
	</div><div class="important"><div class="admonition_header"><h2>SELinux web interface denials</h2></div><div class="admonition"><div class="para">
			SELinux is also preventing the web interface to work correctly. It manifests itself as the error: <span class="emphasis"><em>There are errors in your kickstart template. Please check the 'Kickstart File' tab to determine the problem with the template.</em></span> One can see this when clicking on a kickstart profile. To solve this issue, also run the <code class="command">sealert</code> command, as described earlier.
		</div></div></div></div><div xml:lang="en-US" class="section" id="spacewalk-msat_demo" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="spacewalk-msat_demo">1.9. MSAT Demo</h2></div></div></div><div class="table" id="tabl-msat-guide-MSAT_Demo-Time_needed"><h6>Table 1.25. Time needed</h6><div class="table-contents"><table summary="Time needed" border="1"><colgroup><col width="50%" align="left" class="c1" /><col width="50%" align="left" class="c2" /></colgroup><thead valign="top"><tr><th align="left" valign="top">
						action
					</th><th align="left" valign="top">
						time
					</th></tr></thead><tbody valign="top"><tr><td align="left" valign="top">
						Save Spacewalk content
					</td><td align="left" valign="top">
						1 minute
					</td></tr><tr><td align="left" valign="top">
						Remove Spacewalk content
					</td><td align="left" valign="top">
						1 minute
					</td></tr><tr><td align="left" valign="top">
						Recreate Spacewalk content
					</td><td align="left" valign="top">
						1 minute
					</td></tr><tr><td align="left" valign="top">
						Install test system
					</td><td align="left" valign="top">
						15 minutes
					</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
		Since we have a functional Spacewalk server, we can demonstrate how the MSAT scripts function. In later chapters detailed information is provided about the MSAT scripts. Here, we merely demonstrate how we can create the same <span class="bold bold"><strong>test01</strong></span> kickstart profile in a scripted way.
	</div><div class="para">
		First, we start by saving the current content of the Spacewalk by saving <span class="bold bold"><strong>test01</strong></span>. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp.py</code></strong>
test01

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_wr_kp_hy.py -l test01</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>tree --charset=ASCII -F --noreport test01</code></strong>
test01
|-- ak-test01.sh*
|-- cc-test01.sh*
`-- kp-test01.sh*

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat test01/kp-test01.sh</code></strong>
#!/bin/bash
#
# SCRIPT
#   kp-test01.sh
# DESCRIPTION
#   This script creates the test01
#   kickstart profile.
# ARGUMENTS
#   None.
# RETURN
#   0: success.
# DEPENDENCIES
# FAILURE
#   If you put single quotes around value, but forget to
#   escape embedded single quotes, this script will fail.
#   Escaping works like this:
#   $ echo 'don'"'"'t'
#   don't
#   So ' -&gt; '"'"'
#   Complicated huh?
# AUTHORS
#   Date strings made with 'date +"\%Y-\%m-\%d \%H:\%M"'.
#   Allard Berends (AB), 2013-05-10 17:17
# HISTORY
# LICENSE
#   Copyright (C) 2013 Allard Berends
# 
#   kp-test01.sh is free software; you can
#   redistribute it and/or modify it under the terms of the
#   GNU General Public License as published by the Free
#   Software Foundation; either version 3 of the License, or
#   (at your option) any later version.
#
#   kp-test01.sh is distributed in the hope
#   that it will be useful, but WITHOUT ANY WARRANTY;
#   without even the implied warranty of MERCHANTABILITY or
#   FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
#   Public License for more details.
#
#   You should have received a copy of the GNU General
#   Public License along with this program; if not, write to
#   the Free Software Foundation, Inc., 59 Temple Place -
#   Suite 330, Boston, MA 02111-1307, USA.
# DESIGN
#


ORGNUM=$(msat_ls_org.py)

SATELLITE=$(msat_ls_sn.py)

msat_mk_kp.py \
  --kickstart-label "test01" \
  --kickstart-virt none \
  --kickstart-tree ks-centos-x86_64-server-5u8 \
  --kickstart-satellite $SATELLITE \
  --kickstart-root redhat \
  --kickstart-childchannels '' \
  --kickstart-configmgt true \
  --kickstart-remotecmds true \
  --kickstart-partitioning 'part /boot --fstype=ext3 --size=200,part pv.01 --size=1 --grow,part swap --size=512,volgroup myvg pv.01,logvol / --vgname=myvg --name=rootvol --size=1 --grow' \
  --kickstart-keys 'RPM-GPG-KEY-EPEL-5,RPM-GPG-KEY-spacewalk-2012,RPM-GPG-KEY-CentOS-5,RHN-ORG-TRUSTED-SSL-CERT' \
  --kickstart-install true \
  --kickstart-text true \
  --kickstart-url '--url /var/satellite/rhn/kickstart/ks-centos-x86_64-server-5u8' \
  --kickstart-lang 'en_US' \
  --kickstart-keyboard 'us' \
  --kickstart-zerombr true \
  --kickstart-clearpart '--all' \
  --kickstart-bootloader '--location mbr' \
  --kickstart-timezone '--utc Europe/Amsterdam' \
  --kickstart-auth '--enablemd5 --enableshadow' \
  --kickstart-rootpw '$1$yfdvYZ2s$mXFhCqaiSjZ0mt9M3ZKFr0' \
  --kickstart-selinux '--enforcing' \
  --kickstart-reboot true \
  --kickstart-firewall '--enabled' \
  --kickstart-skipx true \
  --kickstart-key '--skip' \
  --kickstart-software '@ Base' \
  --kickstart-activationkey $ORGNUM-test01 \
  --kickstart-script '/bin/rm /etc/yum.repos.d/CentOS-*.repo'
</pre>

	</div><div class="para">
		As one can see, the kickstart profile and the items it refers to are saved in the <code class="filename">test01</code> directory. Examining the content of, for example, the <code class="filename">test01/kp-test01.sh</code> script, shows that the items are saved in regeneration scripts. This means, if the script is run, it fills the Spacewalk server with the item.
	</div><div class="important"><div class="admonition_header"><h2>Order of running scripts</h2></div><div class="admonition"><div class="para">
			The kickstart profile depends on the activation key. The activation key, on its turn, depends on the config channel with config file. Running the kickstart regeneration script first, results in an error. It can not find the specified activation key.
		</div></div></div><div class="para">
		Now, it is time to unregister the already installed system. We do this with: <span class="guimenu"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Spacewalk Login: example</strong></span> → <span class="guimenuitem"><strong>Password: redhat</strong></span>+<span class="guibutton"><strong>Sign In</strong></span> → <span class="guimenuitem"><strong>Systems</strong></span> → <span class="guimenuitem"><strong>dmm01.dmsat1.org</strong></span> → <span class="guimenuitem"><strong>delete system</strong></span> → <span class="guimenuitem"><strong>Delete Profile</strong></span>
	</div><div class="para">
		Here, we show how to delete the system items (system in Cobbler, kickstart profiles, activation keys, config channels) in the Spacewalk server. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler system list</code></strong>
   SpacewalkDefaultOrganization_kvm_dmm01
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler system remove --name SpacewalkDefaultOrganization_kvm_dmm01</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_kp_all.sh; msat_rm_ak_all.sh; msat_rm_cc_all.sh</code></strong></pre>

	</div><div class="warning"><div class="admonition_header"><h2>Run msat_rm_*_all.sh only on a test Spacewalk</h2></div><div class="admonition"><div class="para">
			Although very handy during a development phase of a system, the <code class="command">msat_rm_*_all.sh</code> commands completely remove all items (kickstart profiles, activation keys, config channels) in the Spacewalk server. Do this on a production system to find out that all your system definitions are gone. Even if you can restore it with MSAT regeneration scripts, still all the production systems need to be reregistered on the Spacewalk server!
		</div></div></div><div class="para">
		Now, we run the regeneration scripts in the right order to create the system items again. The right order is automatically executed by <code class="command">msat_mk_kp_hy.sh</code>. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cd</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_kp_hy.sh -d /root/test01</code></strong>
/usr/local/bin/msat/msat_mk_kp_hy.sh: line 134: ./cs*: No such file or directory
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>./cobbler-dmm01.sh</code></strong>
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>sudo cobbler buildiso --iso=/var/www/cobbler/pub/example/centos5u8-test01-kvm.iso --profiles="" --systems="SpacewalkDefaultOrganization_kvm_dmm01" --tempdir=/tmp</code></strong>
.. output skipped ..
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>scp /var/www/cobbler/pub/example/centos5u8-test01-kvm.iso root@192.168.5.1:/tmp</code></strong>
root@192.168.5.1's password: <strong class="userinput"><code>redhat</code></strong>
centos5u8-test01-kvm.iso                      100%   14MB  14.3MB/s   00:00
</pre>

	</div><div class="para">
		The installation is started with: 
<pre class="screen">
<code class="prompt">server#</code> <strong class="userinput"><code>virt-install \</code></strong>
  <strong class="userinput"><code>--connect qemu:///system \</code></strong>
  <strong class="userinput"><code>--name=dmm01 \</code></strong>
  <strong class="userinput"><code>--ram=512 \</code></strong>
  <strong class="userinput"><code>--arch=x86_64 \</code></strong>
  <strong class="userinput"><code>--description="Provisioning test machine" \</code></strong>
  <strong class="userinput"><code>--cdrom /tmp/centos5u8-test01-kvm.iso \</code></strong>
  <strong class="userinput"><code>--os-type=linux \</code></strong>
  <strong class="userinput"><code>--os-variant=rhel5.4 \</code></strong>
  <strong class="userinput"><code>--disk path=/dev/e/mm,device=disk,bus=scsi \</code></strong>
  <strong class="userinput"><code>--network=network=dmsat1,mac=52:54:00:a8:05:64 \</code></strong>
  <strong class="userinput"><code>--graphics vnc \</code></strong>
  <strong class="userinput"><code>--hvm \</code></strong>
  <strong class="userinput"><code>--autostart</code></strong>
.. output skipped, about 10 minutes ..
</pre>
		 Select <span class="bold bold"><strong>SpacewalkDefaultOrganization_kvm_dmm01</strong></span> and press <span class="keycap"><strong>Enter</strong></span>.
	</div></div></div><div xml:lang="en-US" class="chapter" id="chap-msat-guide-MSAT_scripts" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 2. MSAT scripts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#msat-conf">2.1. MSAT configuration</a></span></dt><dt><span class="section"><a href="#msat-make">2.2. Make commands</a></span></dt><dt><span class="section"><a href="#msat-list">2.3. List commands</a></span></dt><dt><span class="section"><a href="#msat-remove">2.4. Remove commands</a></span></dt><dt><span class="section"><a href="#msat-write">2.5. Write commands</a></span></dt></dl></div><div class="para">
		This chapter discusses how we use the Satellite API and what software we use to build the Meta SATellite (MSAT) scripts.
	</div><div class="para">
		We start by explaining the data model we use for the Satellite data objects. Their relations are shown in <a class="xref" href="#figu-msat-guide-MSAT_scripts-Simplified_Satellite_data_model">Figure 2.1, “Simplified Satellite data model”</a>. 
		<div class="figure" id="figu-msat-guide-MSAT_scripts-Simplified_Satellite_data_model"><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/sat_data_model.png" align="middle" height="720" alt="Simplified Satellite data model" /><div class="longdesc"><pre class="screen">
        +----+     +----+
        | kp |--+--| sc |
        +----+  |  +----+
                |
                |  +----+
                +--|rpm |
                |  +----+
                |
                |  +----+     +----+
                +--| ak |--+--|rpm |
                |  +----+  |  +----+
                |          |
                |          |  +----+
                |          +--| sc |
                |          |  +----+
                |          |
                |          |  +----+     +----+
                |          +--| cc |-----| cf |
                |             +----+     +----+
                |
                |  +----+     +----+
                +--| cs |-----| cs |
                   +----+     +----+
</pre></div></div></div><h6>Figure 2.1. Simplified Satellite data model</h6></div><br class="figure-break" />

	</div><div class="para">
		Some points to understand in the data model: 
		<div class="variablelist"><dl><dt class="varlistentry"><span class="term">kickstart profile</span></dt><dd><div class="para">
						The kickstart profile determines the kickstart file used for installation of a system. Because some extra scripting code is added by the Satellite server, also the configuration from the Satellite server is deployed on the installing system. Hence, the kickstart profile determines the system type. Per type of system, only one kickstart profile exists.
					</div></dd><dt class="varlistentry"><span class="term">software channel</span></dt><dd><div class="para">
						A software channel is a container for RPM's on the Satellite. The base channel as specified by the kickstart profile, determines what RHEL major version is installed on the system. A base channel may have a number of child channels on a system. This way a hierarchy of software packages can be defined on the Satellite for specific type of installations. Always exactly one base channel is connected to the kickstart profile.
					</div><div class="para">
						On the Satellite server it is possible to clone software channels. This has the advantage, that in practise the software channel is frozen. Only if the administrator manually adds RPM's, the contents of the software channel changes.
					</div></dd><dt class="varlistentry"><span class="term">RPM</span></dt><dd><div class="para">
						An RPM is a RPM Package Manager software packet. During installation of a system, RPM's are installed on it to provide the needed software. The RPM box here is mentioned because it illustrates that it is possible to install extra software packages via either a kickstart profile, or activation keys.
					</div><div class="para">
						It is also possible to install an RPM from the post install script, or cobbler snippet. We try to avoid that, since it is not that apparent. So, RPM's must be defined in the activation keys. Only if installation must be avoided, the must be set in the kickstart profile, prefixed with a '-' sign. For example: <code class="code">-bluez-utils</code>.
					</div></dd><dt class="varlistentry"><span class="term">activation key</span></dt><dd><div class="para">
						An activation key, is a container for RPM's, config channels, and list of possible child channels to subscribe to. It is referenced by the kickstart profile. A kickstart profile can reference 0 or more activation keys.
					</div><div class="para">
						Unfortunately, it is not possible to give an order to the referenced activation keys. Therefore, no way exists to give precedence to config channels that may contain the same <code class="filename">filename</code>.
					</div></dd><dt class="varlistentry"><span class="term">cobbler snippet</span></dt><dd><div class="para">
						A cobbler snippet is a piece of script code. Normally it is <code class="command">bash</code> code. Cobbler snippets provide a way to modularize the the pre/post install scripts. A piece of scripting code is given a name so that it can be reused in other snippets or in other scripts (of other kickstart profiles). Cobbler snippets may exist, but it is not necessary, hence the '*' character in the relation line.
					</div><div class="para">
						In the figure, <a class="xref" href="#figu-msat-guide-MSAT_scripts-Simplified_Satellite_data_model">Figure 2.1, “Simplified Satellite data model”</a>, a second rounded box with "cobbler snippet" is drawn. This means that from a cobbler snippet another cobbler snippet can be referenced. This can nest deeply!
					</div></dd><dt class="varlistentry"><span class="term">child channel</span></dt><dd><div class="para">
						A child channel is a software channel. It is a child of the base channel. A base channel is for example rhel-server-6, which means: Red Hat Enterprise Linux, server variant, major version 6. A node always uses a base channel, but can also be subscribed to child channels. If it is subscribed to child channels, the node can install RPM's via <code class="command">yum</code>.
					</div></dd><dt class="varlistentry"><span class="term">config channel</span></dt><dd><div class="para">
						A config channel is a collection of config files. If a config channel is referenced by an activation key, its contents, the config files, will be deployed on a node that uses that activation key. So the config channel is merely a container for config files. An activation key can connect to the config channels, but this is not necessary.
					</div></dd><dt class="varlistentry"><span class="term">config file</span></dt><dd><div class="para">
						A config file is deployed by the Satellite server after the base installation is finished. If it is changed lateron, it can be redeployed at all times at a node by using the <code class="command">rhncfg-client get <code class="filename">&lt;filename&gt;</code></code> command.
					</div><div class="para">
						A config file is always contained in a config channel. The '*' indicates that a config channel does not necessarily need to contain a config file.
					</div></dd></dl></div>

	</div><div class="para">
		In the commands, we use the following abbreviations to build up the name of the command: 
		<div class="table" id="tabl-msat-guide-MSAT_scripts-Command_part_abbreviations"><h6>Table 2.1. Command part abbreviations</h6><div class="table-contents"><table summary="Command part abbreviations" border="1"><colgroup><col width="33%" align="left" class="c1" /><col width="67%" align="left" class="c2" /></colgroup><thead><tr><th align="left">
							abbreviation
						</th><th align="left">
							explanation
						</th></tr></thead><tbody><tr><td align="left">
							ak
						</td><td align="left">
							activation key
						</td></tr><tr><td align="left">
							cc
						</td><td align="left">
							config channel
						</td></tr><tr><td align="left">
							cf
						</td><td align="left">
							config file
						</td></tr><tr><td align="left">
							co
						</td><td align="left">
							custom option
						</td></tr><tr><td align="left">
							cs
						</td><td align="left">
							cobbler snippet
						</td></tr><tr><td align="left">
							hy
						</td><td align="left">
							hierarchy
						</td></tr><tr><td align="left">
							kp
						</td><td align="left">
							kickstart profile
						</td></tr><tr><td align="left">
							msat
						</td><td align="left">
							meta satellite
						</td></tr><tr><td align="left">
							sc
						</td><td align="left">
							software channel
						</td></tr><tr><td align="left">
							sys
						</td><td align="left">
							system
						</td></tr></tbody></table></div></div><br class="table-break" />

	</div><div class="para">
		So, for example, the command <span class="emphasis"><em>msat_ls_cc_cf</em></span> means: meta satelliste list config channel config files. It will show the config files known to the specified config channel.
	</div><div xml:lang="en-US" class="section" id="msat-conf" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="msat-conf">2.1. MSAT configuration</h2></div></div></div><div class="para">
		Before we can start using the Satellite API, we need to know a number of connection parameters. These are needed to connect to the Satellite server with XML RPC. Because the connection parameters are used with all Satellite API scripts, we have placed them in a special configuration file <code class="filename">.sat.conf</code>, which should be placed in the home directory of the Satellite API user.
	</div><div class="para">
		To be complete, it is possible to have a system wide configuration file, <code class="filename">/etc/sat.conf</code>. The settings here are read first, and can be overruled by the settings in <code class="filename">~/.sat.conf</code>.
	</div><div class="para">
		The parameters are: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Specific for the Satellite API: 
					<div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="emphasis"><em>url</em></span>. This parameter specifies the URL of the Satellite API, to which must be connected with XML RPC.
							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>login</em></span>. The login name of the Satellite account via which one is allowed to configure the Satellite. This account is created via the web interface and must have sufficient rights. This can be done in the <span class="emphasis"><em>Admin</em></span> menu.
							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>password</em></span>. The password belonging to the Satellite account.
							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>rpmpath</em></span>. The path, directory, where the Satellite places all RPM information.
							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>version</em></span>. Version of the Satellite used. Small differences exist among version 5.3, 5.4, and 5.5. Version 5.5 is preferred since it provides the possibility to correctly transport ASCII config files in Base64 encoded format. For the Spacewalk 1.9 Server, also specify version 5.5.
							</div></li></ul></div>

				</div></li><li class="listitem"><div class="para">
					Specific for the Cobbler API: 
					<div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="emphasis"><em>url</em></span>. The URL of the Cobbler API to which must be connected with XML RPC.
							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>login</em></span>. The login name of the Cobbler account. If the Satellite is configured correctly, then this is managed by the Satellite setting and should be the same as the Satellite account. Correct Cobbler settings are: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>grep ^redhat_management_permissive /etc/cobbler/settings</code></strong>
redhat_management_permissive: 1
</pre>

							</div></li><li class="listitem"><div class="para">
								<span class="emphasis"><em>password</em></span>. Same as the Satellite password as long as the Cobbler setting are set correclty. See the <span class="emphasis"><em>login</em></span> parameter above.
							</div></li></ul></div>

				</div></li></ul></div>

	</div><div class="para">
		To demonstrate the use of the parameters, we show the configuration file we use for all the examples in this book: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>cat ~/.sat.conf</code></strong>
#
# CONFIGURATION
#   .sat.conf
# DESCRIPTION
#   Configures the Satellite parameters.
# AUTHORS
#   Date strings made with 'date +"\%Y-\%m-\%d \%H:\%M"'.
#   Allard Berends (AB), 2013-05-14 18:29
# HISTORY
# LICENSE
#   Copyright (C) 2013 Allard Berends
# 
#   .sat.conf is free software; you can redistribute it
#   and/or modify it under the terms of the GNU General Public
#   License as published by the Free Software Foundation;
#   either version 3 of the License, or (at your option) any
#   later version.
#
#   .sat.conf is distributed in the hope that it will be
#   useful, but WITHOUT ANY WARRANTY; without even the implied
#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#   PURPOSE. See the GNU General Public License for more
#   details.
#
#   You should have received a copy of the GNU General Public
#   License along with this program; if not, write to the Free
#   Software Foundation, Inc., 59 Temple Place - Suite 330,
#   Boston, MA 02111-1307, USA.
# DESIGN
#   All default values for the sections that are hard coded
#   are given in this file, commented out. This way, we
#   think, it is very easy to find non-standard
#   configuration parameters. So searching for non-default
#   values is a question of running:
#   $ grep '^[^#]' sat.conf

# No default section exists! All parameters live inside a
# section. Other parameters are ignored.
# All the default values are given, but are commented out.
# We feel that this way an administrator can very quickly
# scan for non-default values. It makes clear how the
# configuration is.

# The satellite section does not have default values. Hence,
# they need to be specified here, or on the command line.
[satellite]
url      = http://192.168.5.11/rpc/api
login    = example
password = redhat
rpmpath  = /var/satellite
version  = 5.5

[cobbler]
url      = http://192.168.5.11/cobbler_api
login    = example
password = redhat
</pre>

	</div><div class="para">
		The settings in the configuration file can be overruled on the command line. For example: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp.py --satellite-url=http://localhost/rpc/api</code></strong>
dl380g5-server-6-1_0
</pre>
		 To see the available command line options to configure a command: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp.py -h</code></strong>
Usage: list kickstart profiles

This script lists the kickstart profiles on the specified Satellite server.

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -x, --xml-help        Print help in XML format
  -f PARAMS_FILE, --params-file=PARAMS_FILE
                        path to the parameter file. Default is ~/.sat.conf
  -u SATELLITE_URL, --satellite-url=SATELLITE_URL
                        Satellite RPC API URL to use
  -a SATELLITE_LOGIN, --satellite-login=SATELLITE_LOGIN
                        admin account to log in with on Satellite
  -p SATELLITE_PASSWORD, --satellite-password=SATELLITE_PASSWORD
                        password belonging to Satellite admin account
  -v SATELLITE_VERSION, --satellite-version=SATELLITE_VERSION
                        version of the Satellite API
</pre>

	</div></div><div xml:lang="en-US" class="section" id="msat-make" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="msat-make">2.2. Make commands</h2></div></div></div><div class="para">
		This section provides information on the commands that can be used to make data elements on the Satellite server. Data elements are, for example, config files, config channels, activation keys, cobbler snippets, and kickstart profiles.
	</div><div class="para">
		The list of commands is: 
		<div class="variablelist"><dl><dt class="varlistentry"><span class="term"><code class="command">msat_mk_ak.py</code></span></dt><dd><div class="para">
						This command creates the specified activation key. Note that, if it connects to 1 or more config channels, these must be created first.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_cc_cf.py</code></span></dt><dd><div class="para">
						This command creates the specified config file in the specified config channel. Note that the config channel must exist prior to adding config files to it.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_cc.py</code></span></dt><dd><div class="para">
						This command creates the specified config channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_cs.py</code></span></dt><dd><div class="para">
						This command creates the specified cobbler snippet.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_kp.py</code></span></dt><dd><div class="para">
						This command creates the specified kickstart profile.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_sc.py</code></span></dt><dd><div class="para">
						This command creates the specified software channel. With the already available <code class="command">rhnpush</code> one can add RPM's to the software channel. In this section we will not show an example of this command. To get more information, do: <code class="command">msat_mk_sc.py -h</code>
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_mk_sc_org.py</code></span></dt><dd><div class="para">
						This command makes the specified software channel shared to the specified Satellite organization. This way, the Satellite admin can share software channels to Satellite organizations. In this section we will not show an example of this command. To get more information, do: <code class="command">msat_mk_sc_org.py -h</code>
					</div></dd></dl></div>

	</div><div class="para">
		To illustrate the usage of the above commands, we show some examples here. The commands need a functional Spacewalk or Satellite server.
	</div><div class="para">
		On the Satellite server we will create a simple kickstart profile that references one Cobbler snippet, one activation key and indirectly one config channel with config files. The hierarchy is: 
<pre class="screen">
<span class="emphasis"><em>name</em></span>                            <span class="emphasis"><em>type</em></span>
simple                          kp
  simple                        cs
  1-simple                      ak
    simple                      cc
      /etc/hosts                cf
      /etc/init/serial.conf     cf
      /etc/sysconfig/iptables   cf
</pre>

	</div><div class="para">
		The order in which we create the Satellite datastructures is: 
		<div class="itemizedlist"><ul><li class="listitem"><div class="para">
					The config channel <span class="emphasis"><em>simple</em></span>. Once it exists, we can create the config files: 
					<div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="filename">/etc/hosts</code>. In case DNS does not function properly, we want at least be able to find the NTP time servers.
							</div></li><li class="listitem"><div class="para">
								<code class="filename">/etc/init/serial.conf</code>. We add a serial interface for the KVM (Kernel Virtualization Module) machine. This way we have access to the guest machine via the host machine. So, network is not needed to log in.
							</div></li><li class="listitem"><div class="para">
								<code class="filename">/etc/sysconfig/iptables</code>. A minimal firewall configuration that allows us to connect to the machine via SSH.
							</div></li></ul></div>

				</div></li><li class="listitem"><div class="para">
					The activation key <span class="emphasis"><em>1-simple</em></span>. Note that in the script the activation key label is specified without the '1-'.
				</div></li><li class="listitem"><div class="para">
					The Cobbler snippet <span class="emphasis"><em>simple</em></span>. It is not absolutely needed prior to the creation of the kickstart profile, but when the kickstart file is generated, it must be present.
				</div></li><li class="listitem"><div class="para">
					The kickstart profile <span class="emphasis"><em>simple</em></span>. This is the last element to create. Note that we assume that all software channels and all referenced RPM's are present.
				</div></li></ul></div>

	</div><div class="para">
		The actual commands to create the above elements are shown below. Normally we place these commands in bash scripts. Here, we just paste them to the command line for demonstration purposes.
	</div><div class="para">
		First create the <span class="emphasis"><em>simple</em></span> config channel. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_cc.py \</code></strong>
<strong class="userinput"><code> --configchannel-label simple \</code></strong>
<strong class="userinput"><code> --configchannel-description simple \</code></strong>
<strong class="userinput"><code> --configchannel-name simple</code></strong>
.. cc simple created ..
</pre>

	</div><div class="para">
		Now, we create the 3 config files. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_cc_cf.py \</code></strong>
<strong class="userinput"><code> --configchannel-label simple \</code></strong>
<strong class="userinput"><code> --configpath-path /etc/hosts \</code></strong>
<strong class="userinput"><code> --configpath-dir false \</code></strong>
<strong class="userinput"><code> --configpath-content - \</code></strong>
<strong class="userinput"><code> --configpath-user root \</code></strong>
<strong class="userinput"><code> --configpath-group root \</code></strong>
<strong class="userinput"><code> --configpath-permissions 644 \</code></strong>
<strong class="userinput"><code> --configpath-startdelimiter '{|' \</code></strong>
<strong class="userinput"><code> --configpath-enddelimiter '|}' &lt;&lt; 'EOF__BLAH__EOF'</code></strong>
<strong class="userinput"><code># Do not remove the following line, or various programs</code></strong>
<strong class="userinput"><code># that require network functionality will fail.</code></strong>
<strong class="userinput"><code>127.0.0.1 localhost.localdomain localhost</code></strong>
<strong class="userinput"><code></code></strong>
<strong class="userinput"><code># Provisioning via Satellite</code></strong>
<strong class="userinput"><code>172.16.30.198 psat.example.org psat</code></strong>
<strong class="userinput"><code></code></strong>
<strong class="userinput"><code># Time service via NTP</code></strong>
<strong class="userinput"><code>172.16.30.10 ntp1.example.org ntp1</code></strong>
<strong class="userinput"><code>172.16.30.11 ntp2.example.org ntp2</code></strong>
<strong class="userinput"><code>EOF__BLAH__EOF</code></strong>
.. cf /etc/hosts created in cc simple ..

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_cc_cf.py \</code></strong>
<strong class="userinput"><code> --configchannel-label simple \</code></strong>
<strong class="userinput"><code> --configpath-path /etc/sysconfig/iptables \</code></strong>
<strong class="userinput"><code> --configpath-dir false \</code></strong>
<strong class="userinput"><code> --configpath-content - \</code></strong>
<strong class="userinput"><code> --configpath-user root \</code></strong>
<strong class="userinput"><code> --configpath-group root \</code></strong>
<strong class="userinput"><code> --configpath-permissions 644 \</code></strong>
<strong class="userinput"><code> --configpath-startdelimiter '{|' \</code></strong>
<strong class="userinput"><code> --configpath-enddelimiter '|}' &lt;&lt; 'EOF__BLAH__EOF'</code></strong>
<strong class="userinput"><code>*filter</code></strong>
<strong class="userinput"><code>:INPUT ACCEPT [0:0]</code></strong>
<strong class="userinput"><code>:FORWARD ACCEPT [0:0]</code></strong>
<strong class="userinput"><code>:OUTPUT ACCEPT [0:0]</code></strong>
<strong class="userinput"><code>:RH-Firewall-1-INPUT - [0:0]</code></strong>
<strong class="userinput"><code>-A INPUT -j RH-Firewall-1-INPUT</code></strong>
<strong class="userinput"><code>-A FORWARD -j RH-Firewall-1-INPUT</code></strong>
<strong class="userinput"><code>-A RH-Firewall-1-INPUT -i lo -j ACCEPT</code></strong>
<strong class="userinput"><code>-A RH-Firewall-1-INPUT -m icmp -p icmp --icmp-type any -j ACCEPT</code></strong>
<strong class="userinput"><code>-A RH-Firewall-1-INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</code></strong>
<strong class="userinput"><code>-A RH-Firewall-1-INPUT -m tcp -p tcp --dport 22 -m comment --comment "SSH" -j ACCEPT</code></strong>
<strong class="userinput"><code>-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited</code></strong>
<strong class="userinput"><code>COMMIT</code></strong>
<strong class="userinput"><code>EOF__BLAH__EOF</code></strong>
.. cf /etc/sysconfig/iptables created in cc simple ..

<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_cc_cf.py \</code></strong>
<strong class="userinput"><code> --configchannel-label simple \</code></strong>
<strong class="userinput"><code> --configpath-path /etc/init/serial.conf \</code></strong>
<strong class="userinput"><code> --configpath-dir false \</code></strong>
<strong class="userinput"><code> --configpath-content - \</code></strong>
<strong class="userinput"><code> --configpath-user root \</code></strong>
<strong class="userinput"><code> --configpath-group root \</code></strong>
<strong class="userinput"><code> --configpath-permissions 644 \</code></strong>
<strong class="userinput"><code> --configpath-startdelimiter '{|' \</code></strong>
<strong class="userinput"><code> --configpath-enddelimiter '|}' &lt;&lt; 'EOF__BLAH__EOF'</code></strong>
<strong class="userinput"><code># Automatically start a configured serial console</code></strong>
<strong class="userinput"><code>#</code></strong>
<strong class="userinput"><code># How this works:</code></strong>
<strong class="userinput"><code>#</code></strong>
<strong class="userinput"><code># On boot, a udev helper examines /dev/console. If a serial console is the</code></strong>
<strong class="userinput"><code># primary console (last console on the commandline in grub), the event</code></strong>
<strong class="userinput"><code># 'fedora.serial-console-available &lt;port name&gt; &lt;speed&gt;' is emitted, which</code></strong>
<strong class="userinput"><code># triggers this script. It waits for the runlevel to finish, ensures</code></strong>
<strong class="userinput"><code># the proper port is in /etc/securetty, and starts the getty.</code></strong>
<strong class="userinput"><code>#</code></strong>
<strong class="userinput"><code># If your serial console is not the primary console, or you want a getty</code></strong>
<strong class="userinput"><code># on serial even if it's not the consce $DEV</code></strong>
<strong class="userinput"><code>#respawn</code></strong>
<strong class="userinput"><code>#pre-start exec /sbin/securetty $DEV</code></strong>
<strong class="userinput"><code>#exec /sbin/agetty /dev/$DEV $SPEED vt100-nav</code></strong>
<strong class="userinput"><code>EOF__BLAH__EOF</code></strong>
.. cf /etc/init/serial.conf created in cc simple ..
</pre>

	</div><div class="para">
		Next, we can create the activation key <span class="emphasis"><em>simple</em></span>. As can be seen in the <code class="option">--activationkey-configchannels</code>, it needs the <span class="emphasis"><em>simple</em></span> config channel. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_ak.py \</code></strong>
<strong class="userinput"><code> --activationkey-label simple \</code></strong>
<strong class="userinput"><code> --activationkey-description simple \</code></strong>
<strong class="userinput"><code> --activationkey-basechannel rhel-x86_64-server-6 \</code></strong>
<strong class="userinput"><code> --activationkey-monitoring false \</code></strong>
<strong class="userinput"><code> --activationkey-provisioning true \</code></strong>
<strong class="userinput"><code> --activationkey-virtualization false \</code></strong>
<strong class="userinput"><code> --activationkey-node false \</code></strong>
<strong class="userinput"><code> --activationkey-configuration true \</code></strong>
<strong class="userinput"><code> --activationkey-universal false \</code></strong>
<strong class="userinput"><code> --activationkey-childchannels 'rhn-tools-rhel-x86_64-server-6' \</code></strong>
<strong class="userinput"><code> --activationkey-packages 'nmap,ntp,screen,strace,sysstat,vim-enhanced,dmidecode,sg3_utils,lsscsi,tree,rhncfg,rhncfg-actions,rhncfg-client,rhncfg-management' \</code></strong>
<strong class="userinput"><code> --activationkey-configchannels 'simple'</code></strong>
</pre>

	</div><div class="para">
		Before we can finish we create the Cobbler snippet used by the kickstart profile. The snippet is named <span class="emphasis"><em>simple</em></span> too. Note that we need to escape the embedded quotes. So, if we want to use a quote in bash in the form: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo 'don[quote]t'</code></strong>
don[quote]t
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo 'don'"'"'t'</code></strong>
don't
</pre>
		 The above statement works because bash concatenates the string parts. For example: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo 'a''b''c'</code></strong>
abc
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>echo 'abc'</code></strong>
abc
</pre>
		 So, we can always embed a quote in the other style of quotes. So a single quote inside double quotes and vice versa. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_cs.py \</code></strong>
<strong class="userinput"><code> --snippet-name simple \</code></strong>
<strong class="userinput"><code> --snippet-content '# AB: Daemon services that needs to be on or off that come</code></strong>
<strong class="userinput"><code># from a base installation.</code></strong>
<strong class="userinput"><code>#/sbin/chkconfig avahi-daemon off</code></strong>
<strong class="userinput"><code>#/sbin/chkconfig bluetooth off</code></strong>
<strong class="userinput"><code>#/sbin/chkconfig cups off</code></strong>
<strong class="userinput"><code>/sbin/chkconfig firstboot off</code></strong>
<strong class="userinput"><code>/sbin/chkconfig kudzu off</code></strong>
<strong class="userinput"><code>/sbin/chkconfig lm_sensors off</code></strong>
<strong class="userinput"><code>#/sbin/chkconfig kdump off</code></strong>
<strong class="userinput"><code></code></strong>
<strong class="userinput"><code># AB: adapt GRUB to have serial console for KVM.</code></strong>
<strong class="userinput"><code>/bin/sed -e '"'"'/^timeout/a \</code></strong>
<strong class="userinput"><code>serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1 \</code></strong>
<strong class="userinput"><code>terminal --timeout=5 serial console'"'"' \</code></strong>
<strong class="userinput"><code> -e '"'"'/^splashimage/s/^/#/'"'"' \</code></strong>
<strong class="userinput"><code> -e '"'"'/^hiddenmenu/s/^/#/'"'"' \</code></strong>
<strong class="userinput"><code> -e '"'"'/[ ]\{1,\}kernel/s/rhgb quiet$/console=ttyS0,115200n8/'"'"' \</code></strong>
<strong class="userinput"><code> /boot/grub/grub.conf</code></strong>
<strong class="userinput"><code>'</code></strong>
</pre>

	</div><div class="para">
		We end with adding the kickstart profile to the Satellite. Again we escape the single quotes. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_mk_kp.py \</code></strong>
<strong class="userinput"><code> --kickstart-label simple \</code></strong>
<strong class="userinput"><code> --kickstart-virt none \</code></strong>
<strong class="userinput"><code> --kickstart-tree ks-rhel-x86_64-server-6-6.3 \</code></strong>
<strong class="userinput"><code> --kickstart-satellite psat.example.org \</code></strong>
<strong class="userinput"><code> --kickstart-root redhat \</code></strong>
<strong class="userinput"><code> --kickstart-childchannels '' \</code></strong>
<strong class="userinput"><code> --kickstart-configmgt true \</code></strong>
<strong class="userinput"><code> --kickstart-remotecmds true \</code></strong>
<strong class="userinput"><code> --kickstart-partitioning 'partition pv.00 --size=1 --grow,partition /boot --fstype=ext4 --size=100,volgroup vg_os pv.00,logvol swap --fstype swap --name=swap --vgname=vg_os --size=512,logvol / --fstype ext4 --name=root --vgname=vg_os --size=1024 --grow' \</code></strong>
<strong class="userinput"><code> --kickstart-keys 'RHN-ORG-TRUSTED-SSL-CERT' \</code></strong>
<strong class="userinput"><code> --kickstart-install true \</code></strong>
<strong class="userinput"><code> --kickstart-text true \</code></strong>
<strong class="userinput"><code> --kickstart-url '--url /rhn/kickstart/ks-rhel-x86_64-server-6-6.3' \</code></strong>
<strong class="userinput"><code> --kickstart-lang 'en_US' \</code></strong>
<strong class="userinput"><code> --kickstart-keyboard 'us' \</code></strong>
<strong class="userinput"><code> --kickstart-zerombr 'yes' \</code></strong>
<strong class="userinput"><code> --kickstart-clearpart '--drives=vda --initlabel' \</code></strong>
<strong class="userinput"><code> --kickstart-bootloader '--location mbr --driveorder=vda' \</code></strong>
<strong class="userinput"><code> --kickstart-timezone '--utc Europe/Amsterdam' \</code></strong>
<strong class="userinput"><code> --kickstart-auth '--enablemd5 --enableshadow' \</code></strong>
<strong class="userinput"><code> --kickstart-rootpw '$1$HYefCqjK$DYFA.faC1hU4nUehHgatn1' \</code></strong>
<strong class="userinput"><code> --kickstart-selinux '--enforcing' \</code></strong>
<strong class="userinput"><code> --kickstart-reboot true \</code></strong>
<strong class="userinput"><code> --kickstart-firewall '--enabled' \</code></strong>
<strong class="userinput"><code> --kickstart-skipx true \</code></strong>
<strong class="userinput"><code> --kickstart-key '--skip' \</code></strong>
<strong class="userinput"><code> --kickstart-software '@Base,-bluez-utils,-ccid,-coolkey,-ifd-egate,-pcsc-lite,-yum-updatesd' \</code></strong>
<strong class="userinput"><code> --kickstart-activationkey 1-simple \</code></strong>
<strong class="userinput"><code> --kickstart-script '$SNIPPET('"'"'spacewalk/1/simple'"'"')</code></strong>
<strong class="userinput"><code>'</code></strong>
</pre>

	</div><div class="para">
		A good trick to check the result, is to use Cobbler. In the following screendump we show the Cobbler command to obtain the complete kickstart file. Since we have not filled in the network details, these are not yet present. The <span class="emphasis"><em>2 vertical dots</em></span> show places where we have truncated the output. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>/usr/bin/cobbler profile getks --name simple:1:Example</code></strong>
# Kickstart config file generated by RHN Satellite Config Management
# Profile Label : simple
# Date Created  : 2012-10-18 13:17:12.0

install
text
url --url http://psat.example.org/ks/dist/ks-rhel-x86_64-server-6-6.3
lang en_US
keyboard us
zerombr yes
clearpart --drives=vda --initlabel
bootloader --location mbr --driveorder=vda
timezone --utc Europe/Amsterdam
auth --enablemd5 --enableshadow
rootpw --iscrypted $1$HYefCqjK$DYFA.faC1hU4nUehHgatn1
selinux --enforcing
reboot
firewall --enabled
skipx
key --skip
partition pv.00 --size=1 --grow
partition /boot --fstype=ext4 --size=100
volgroup vg_os pv.00
logvol swap --fstype swap --name=swap --vgname=vg_os --size=512
logvol / --fstype ext4 --name=root --vgname=vg_os --size=1024 --grow


%packages 
@Base
-bluez-utils
-ccid
-coolkey
-ifd-egate
-pcsc-lite
-yum-updatesd
%end
.
.
%post
# AB: Daemon services that needs to be on or off that come
# from a base installation.
#/sbin/chkconfig avahi-daemon off
#/sbin/chkconfig bluetooth off
#/sbin/chkconfig cups off
/sbin/chkconfig firstboot off
/sbin/chkconfig kudzu off
/sbin/chkconfig lm_sensors off
#/sbin/chkconfig kdump off

# AB: adapt GRUB to have serial console for KVM.
/bin/sed -e '/^timeout/a \
serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1 \
terminal --timeout=5 serial console' \
    -e '/^splashimage/s/^/#/' \
    -e '/^hiddenmenu/s/^/#/' \
    -e '/[  ]\{1,\}kernel/s/rhgb quiet$/console=ttyS0,115200n8/' \
    /boot/grub/grub.conf
%end

%post
.
.
</pre>

	</div></div><div xml:lang="en-US" class="section" id="msat-list" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="msat-list">2.3. List commands</h2></div></div></div><div class="para">
		This section provides information on the commands that can be used to list information of the data elements. Data elements are, for example, config files, config channels, activation keys, and kickstart profiles.
	</div><div class="para">
		The list of commands is: 
		<div class="variablelist"><dl><dt class="varlistentry"><span class="term"><code class="command">msat_ls_ak_cc.py</code></span></dt><dd><div class="para">
						This command lists the config channels which are referenced by the specified activation key.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_ak_kp.py</code></span></dt><dd><div class="para">
						This command lists the kickstart profiles that link to the specified activation key.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_ak.py</code></span></dt><dd><div class="para">
						This command lists the activation keys defined by the organization on which one logs in. Organization is determined by the user account used to log in to the Satellite by the API scripts.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_cc_ak.py</code></span></dt><dd><div class="para">
						This command lists the activation keys that link to the specified config channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_cc_cf.py</code></span></dt><dd><div class="para">
						This command lists the configuration files belonging to the specified config channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_cc.py</code></span></dt><dd><div class="para">
						This command lists the config channels belonging to the organization on which one is logged in.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_cf_cc.py</code></span></dt><dd><div class="para">
						This command lists the config channels containing the specified config file.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_cs.py</code></span></dt><dd><div class="para">
						This command lists the custom Cobbler snippets belonging to the organization to which one is logged in.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp_ak.py</code></span></dt><dd><div class="para">
						This command lists the activation keys, referenced by the specified kickstart profile.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp_co.py</code></span></dt><dd><div class="para">
						This command lists the custom options belonging to the specified kickstart profile.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp_cs.py</code></span></dt><dd><div class="para">
						This command lists cobbler snippet names, referenced by the specified kickstart profile or indirectly by other cobbler snippets.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp_hy.py</code></span></dt><dd><div class="para">
						This command lists all the data elements connected to the specified kickstart profile. The output is displayed hierarchically.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp_sys.py</code></span></dt><dd><div class="para">
						This command lists all the systems in Cobbler that use the specified kickstart profile.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_kp.py</code></span></dt><dd><div class="para">
						This command lists the organization's kickstart profiles.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_sc.py</code></span></dt><dd><div class="para">
						This command lists the software channels available to the organization to which one is logged in.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_ls_sys.py</code></span></dt><dd><div class="para">
						This command lists all the systems registered to the Satellite organization.
					</div></dd></dl></div>

	</div><div class="para">
		To illustrate the usage of the above commands, we show a number of examples here. The commands only work if a working Satellite server is available.
	</div><div class="para">
		On the Satellite server we have configured a kickstart profile that references a number of Cobbler snippets, activation keys and indirectly config channels with config files. The hierarchy is: 
<pre class="screen">
<span class="emphasis"><em>name</em></span>                                    <span class="emphasis"><em>type</em></span>
dl380g5-server-6-1_0                    kp
  support-1_0                           cs
    ssh-generics-1_0                    cs
    ldap-cert-symlink-1_0               cs
    support-runlevel-1_0                cs
      support-runlevel-base-1_0         cs
      support-runlevel-gen-1_0          cs
      support-runlevel-hpgen8-1_0       cs
  1-support-rpms-6-1_0                  ak
  1-dl380g5-server-6-1_0                ak
    dl380g5-server-6-1_0                cc
    hpsim-6-1_0                         cc
      /etc/hosts                        cf
      /etc/snmp/snmpd.conf              cf
      /etc/sudoers.d/hpsmhd             cf
      /etc/sysconfig/iptables           cf
      /etc/sysconfig/snmpd.options      cf
      /opt/hp/hpsmh/conf/smhpd.xml      cf
    support-6-1_0                       cc
      /etc/cron.d/nightly_ntp_sync      cf
      /etc/cron.d/sysstat               cf
      /etc/profile.d/itl.sh             cf
    ntp-6-1_0                           cc
      /etc/ntp.conf                     cf
    ldap-6-1_0                          cc
      /etc/ldap.conf                    cf
      /etc/openldap/ldap.conf           cf
    hypertape-6-1_0                     cc
    hpomw-6-1_0                         cc
    splunk-6-1_0                        cc
    ssh-6-1_0                           cc
      /root/.ssh/authorized_keys        cf
    base-6-1_0                          cc
      /etc/hosts                        cf
      /etc/motd                         cf
      /etc/nsswitch.conf                cf
      /etc/openldap/cacerts/my-ca.crt   cf
      /etc/pam.d/system-auth-ac         cf
      /etc/sudoers                      cf
      /etc/sysconfig/iptables           cf
      /etc/sysconfig/rhn/rhnsd          cf
</pre>

	</div><div class="para">
		The config channels referenced by the <span class="emphasis"><em>1-dl380g5-server-6-1_0</em></span> activation keys are displayed in order. The first one displayed has the highest order or rating. This is om imporance when 2 or more config channels contain the same config file. For example, hpsim-6-1_0 and base-6-1_0 both have an <code class="filename">/etc/hosts</code> file. The one of hpsim-6-1_0 has preference. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_ak_cc.py -l 1-dl380g5-server-6-1_0</code></strong>
dl380g5-server-6-1_0
hpsim-6-1_0
support-6-1_0
ntp-6-1_0
ldap-6-1_0
hypertape-6-1_0
hpomw-6-1_0
splunk-6-1_0
ssh-6-1_0
base-6-1_0
</pre>

	</div><div class="para">
		All the activation keys are displayed. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_ak.py</code></strong>
1-support-rpms-6-1_0
1-dl380g5-server-6-1_0
</pre>

	</div><div class="para">
		Show the paths of the config files belonging to config channel <span class="emphasis"><em>base-6-1_0</em></span>. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_cc_cf.py -l base-6-1_0</code></strong>
/etc/hosts
/etc/motd
/etc/nsswitch.conf
/etc/openldap/cacerts/my-ca.crt
/etc/pam.d/system-auth-ac
/etc/sudoers
/etc/sysconfig/iptables
/etc/sysconfig/rhn/rhnsd
</pre>

	</div><div class="para">
		List all the config channel of the Satellite organization. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_cc.py</code></strong> 
base-6-1_0
dl380g5-server-6-1_0
hpomw-6-1_0
hpsim-6-1_0
hypertape-6-1_0
ldap-6-1_0
ntp-6-1_0
splunk-6-1_0
ssh-6-1_0
support-6-1_0
</pre>

	</div><div class="para">
		List the information of all custom Cobbler snippets. The standard Cobbler snippets are not shown. The standard snippets are used to configure the network, register to the Satellite, etc. The custom Cobbler snippets are the ones we have created ourselves. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_cs.py</code></strong> 
name: ldap-cert-symlink-1_0
contents:
--------------------
# AB: triggered by /etc/openldap/cacerts/my-ca.crt config
# file.
ODIR=\$(/bin/pwd)
cd /etc/openldap/cacerts
HASH=\$(/usr/bin/openssl x509 -in my-ca.crt -noout -hash).0
ln -s my-ca.crt \$HASH
cd \$ODIR
--------------------
fragment: $SNIPPET('spacewalk/1/ldap-cert-symlink-1_0')
file:
/var/lib/cobbler/snippets/spacewalk/1/ldap-cert-symlink-1_0


name: support-runlevel-hpgen8-1_0
contents:
--------------------
# * Hardware monitoring service (HP-SIM, only with HP
#   hardware)
#/sbin/chkconfig snmpd on
#/sbin/chkconfig hp-ilo on
#/sbin/chkconfig hp-health on
#/sbin/chkconfig hp-snmp-agents on
#/sbin/chkconfig hp-asrd on
#/sbin/chkconfig hpsmhd on
--------------------
fragment:
$SNIPPET('spacewalk/1/support-runlevel-hpgen8-1_0')
file:
/var/lib/cobbler/snippets/spacewalk/1/support-runlevel-hpgen8-1_0


.. remainder skipped ..
</pre>

	</div><div class="para">
		Show the activation keys, referenced by the specified kickstart profile. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_ak.py -l dl380g5-server-6-1_0</code></strong>
1-support-rpms-6-1_0
1-dl380g5-server-6-1_0
</pre>

	</div><div class="para">
		Show the custom options defined for the specified kickstart profile. Here, we have defined none. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_co.py -l dl380g5-server-6-1_0</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		Shows the referenced Cobbler snippets of the specified kickstart profile. The indentation shows the hierarchy of the references. This way, one can quickly determine by which Cobbler snippet another Cobbler snippet is referenced. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_cs.py -l dl380g5-server-6-1_0</code></strong>
support-1_0
  ssh-generics-1_0
  ldap-cert-symlink-1_0
  support-runlevel-1_0
    support-runlevel-base-1_0
    support-runlevel-gen-1_0
    support-runlevel-hpgen8-1_0
</pre>

	</div><div class="para">
		List hierarchically the data elements connected to the specified kickstart profile. The purpose of this command is to help the administrator to quickly compare different type of systems as defined by their kickstart profiles. If more details are needed, like the list of RPM's, or the contents of the config files, then the advice is to use the msat_wr_* commands. These commands write the data element creation scripts to stdout. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_hy.py -l dl380g5-server-6-1_0</code></strong>
dl380g5-server-6-1_0
  support-1_0
    ssh-generics-1_0
    ldap-cert-symlink-1_0
    support-runlevel-1_0
      support-runlevel-base-1_0
      support-runlevel-gen-1_0
      support-runlevel-hpgen8-1_0
  1-support-rpms-6-1_0
  1-dl380g5-server-6-1_0
    dl380g5-server-6-1_0
    hpsim-6-1_0
      /etc/hosts
      /etc/snmp/snmpd.conf
      /etc/sudoers.d/hpsmhd
      /etc/sysconfig/iptables
      /etc/sysconfig/snmpd.options
      /opt/hp/hpsmh/conf/smhpd.xml
    support-6-1_0
      /etc/cron.d/nightly_ntp_sync
      /etc/cron.d/sysstat
      /etc/profile.d/itl.sh
    ntp-6-1_0
      /etc/ntp.conf
    ldap-6-1_0
      /etc/ldap.conf
      /etc/openldap/ldap.conf
    hypertape-6-1_0
    hpomw-6-1_0
    splunk-6-1_0
    ssh-6-1_0
      /root/.ssh/authorized_keys
    base-6-1_0
      /etc/hosts
      /etc/motd
      /etc/nsswitch.conf
      /etc/openldap/cacerts/my-ca.crt
      /etc/pam.d/system-auth-ac
      /etc/sudoers
      /etc/sysconfig/iptables
      /etc/sysconfig/rhn/rhnsd
</pre>

	</div><div class="para">
		List all the systems in Cobbler that use the specified kickstart profile. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_sys.py -l app-6-3_2</code></strong> 
test01
</pre>

	</div><div class="para">
		List all the kickstart profiles of the Satellite organization. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp.py</code></strong> 
app-6-3_2
dl380g5-server-6-1_0
</pre>

	</div><div class="para">
		List all the software channels of the Satellite organization. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_sc.py</code></strong> 
hpomw-6
hypertape-6
rhel-x86_64-server-rs-6
redhat-rhn-proxy-5.4-server-x86_64-6
rhel-x86_64-server-6
support-rpms-6
rhel-x86_64-server-ha-6
rhel-x86_64-server-6-rhdirserv-9
hpsim-6
rhel-x86_64-server-optional-6
rhel-x86_64-server-supplementary-6
rhel-x86_64-server-lb-6
rhn-tools-rhel-x86_64-server-6
redhat-rhn-proxy-5.5-server-x86_64-6
splunk-6
</pre>

	</div><div class="para">
		List all the registered systems of the Satellite organization. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_sys.py</code></strong> 
id: 1000010000, name: test01.example.org
</pre>

	</div></div><div xml:lang="en-US" class="section" id="msat-remove" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="msat-remove">2.4. Remove commands</h2></div></div></div><div class="para">
		This section provides information on the commands that can be used to remove data elements. Data elements are, for example, config files, config channels, activation keys, and kickstart profiles. The list of commands is: 
		<div class="variablelist"><dl><dt class="varlistentry"><span class="term"><code class="command">msat_rm_ak.py</code></span></dt><dd><div class="para">
						This command removes the specified activation key.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_cc_cf.py</code></span></dt><dd><div class="para">
						This command removes the specified config file, or list of comma separated config files from the specified config channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_cc.py</code></span></dt><dd><div class="para">
						This command removes the specified config channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_cs.py</code></span></dt><dd><div class="para">
						This command removes the specified cobbler snippet.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_kp.py</code></span></dt><dd><div class="para">
						This command removes the specified kickstart key.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_sc.py</code></span></dt><dd><div class="para">
						This command removes the specified software channel.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_rm_sys.py</code></span></dt><dd><div class="para">
						This command removes the specified system. Inside Satellite systems are known by unique ID. We search for the ID's belonging by the name and delete all systems. So, if a system is registered multiple times under the same name, all are deleted.
					</div></dd></dl></div>

	</div><div class="para">
		To illustrate the usage of the above commands, we show a number of examples here. The commands only work if a working Satellite server is available.
	</div><div class="para">
		In order to demonstrate most of the commands, we have installed a demonstration system called <span class="hardware">dmm01</span>. This system is installed with help of the Satellite server, using the <span class="emphasis"><em>simple</em></span> kickstart profile. On the system we can verify the following items: 
<pre class="screen">
<code class="prompt">dmm01#</code> <strong class="userinput"><code>grep 'Profile Label' *</code></strong>
cobbler.ks:# Profile Label : simple
<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
DoFoS   Config Channel   File
F           simple     /etc/hosts
F           simple     /etc/init/serial.conf
F           simple     /etc/sysconfig/iptables
</pre>

	</div><div class="para">
		First, we delete a config file. We choose <code class="filename">/etc/hosts</code>. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py</code></strong>
Usage: delete config file(s) from config channel

msat_rm_cc_cf.py: error: Error: specify label, -l or --configchannel-label
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py -l simple</code></strong>
Usage: delete config file(s) from config channel

msat_rm_cc_cf.py: error: Error: specify path, -n or --configpath-path
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py -l simple -n /etc/hosts</code></strong>

<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
DoFoS   Config Channel   File
F           simple     /etc/init/serial.conf
F           simple     /etc/sysconfig/iptables
</pre>
		 Clearly, it works as expected. Note that the <code class="filename">/etc/hosts</code> is still present on the <span class="hardware">dmm01</span>.
	</div><div class="para">
		Instead of removing the config file one by one, it is possible to delete the config channel at once. The contained config files are automatically removed too. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc.py -l simple</code></strong>
.. no output ..

<code class="prompt">d19sw1#</code> msat_ls_cc.py | grep simple
.. no output ..

<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
No managed files.
</pre>

	</div><div class="para">
		From the hierarchy of the data elements of the <span class="emphasis"><em>simple</em></span> kickstart profile, we have left: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_hy.py -l simple</code></strong>
simple
  simple
  1-simple
</pre>
		 We now also remove the activation key, <span class="emphasis"><em>1-simple</em></span>. Note that on the command line option, <code class="option">-l</code> or <code class="option">--activationkey-label</code>, we specify the '1-'. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_ak.py -l 1-simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		The Cobbler snippet <span class="emphasis"><em>simple</em></span> can be used by other kickstart profiles too. So, it is dangerous to just delete it. But, by naming convention we know that it belongs to the <span class="emphasis"><em>simple</em></span> kickstart profile, so it is save to remove it. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cs.py -n simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		Now, all that is left from the kickstart profile's hierarchy, is the kickstart profile itself. We remove it here. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_kp.py -l simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		What is still left from the kickstart profile <span class="emphasis"><em>simple</em></span>, is the system <span class="hardware">dmm01</span> that was installed using it. We can show this with: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_sys.py</code></strong>
id: 1000010000, name: test01.example.org
</pre>
		 Now, we remove the system from the Satellite too. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_sys.py -n test01.example.org</code></strong>
Removing the following systems (ID's):
1000010004
</pre>

	</div></div><div xml:lang="en-US" class="section" id="msat-write" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="msat-write">2.5. Write commands</h2></div></div></div><div class="para">
		This section provides information on the commands that can be used to write data elements to stdout. Data elements are, for example, config files, config channels, activation keys, and kickstart profiles. The list of commands is: 
		<div class="variablelist"><dl><dt class="varlistentry"><span class="term"><code class="command">msat_wr_ak.py</code></span></dt><dd><div class="para">
						This command writes the specified activation key to stdout in the form of a regeneration script.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_wr_cc_cf.py</code></span></dt><dd><div class="para">
						This command writes the specified comma separated list of config files, belonging to the specified config channel to a directory in the form of a regeneration scripts.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_wr_cc.py</code></span></dt><dd><div class="para">
						This command writes the specified config channel, including its config files, to stdout in the form of a regeneration script.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_wr_cs.py</code></span></dt><dd><div class="para">
						This command writes the specified cobbler snippet to stdout in the form of a regeneration script.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_wr_kp_hy.py</code></span></dt><dd><div class="para">
						This command writes the specified kickstart profile and all attached elements to a directory. In the directory the regeneration scripts are placed of all the elements.
					</div></dd><dt class="varlistentry"><span class="term"><code class="command">msat_wr_kp.py</code></span></dt><dd><div class="para">
						This command writes the specified kickstart profile to stdout in the form of a kickstart profile regeneration script.
					</div></dd></dl></div>

	</div><div class="para">
		To illustrate the usage of the above commands, we show a number of examples here. The commands only work if a working Satellite server is available.
	</div><div class="para">
		In order to demonstrate most of the commands, we have installed a demonstration system called <span class="hardware">dmm01</span>. This system is installed with help of the Satellite server, using the <span class="emphasis"><em>simple</em></span> kickstart profile. On the system we can verify the following items: 
<pre class="screen">
<code class="prompt">dmm01#</code> <strong class="userinput"><code>grep 'Profile Label' *</code></strong>
cobbler.ks:# Profile Label : simple
<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
DoFoS   Config Channel   File
F           simple     /etc/hosts
F           simple     /etc/init/serial.conf
F           simple     /etc/sysconfig/iptables
</pre>

	</div><div class="para">
		Firt, we delete a config file. We choose <code class="filename">/etc/hosts</code>. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py</code></strong>
Usage: delete config file(s) from config channel

msat_rm_cc_cf.py: error: Error: specify label, -l or --configchannel-label
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py -l simple</code></strong>
Usage: delete config file(s) from config channel

msat_rm_cc_cf.py: error: Error: specify path, -n or --configpath-path
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc_cf.py -l simple -n /etc/hosts</code></strong>

<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
DoFoS   Config Channel   File
F           simple     /etc/init/serial.conf
F           simple     /etc/sysconfig/iptables
</pre>
		 Clearly, it works as expected. Note that the <code class="filename">/etc/hosts</code> is still present on the <span class="hardware">dmm01</span>.
	</div><div class="para">
		Instead of removing the config file one by one, it is possible to delete the config channel at once. The contained config files are automatically removed too. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cc.py -l simple</code></strong>
.. no output ..

<code class="prompt">d19sw1#</code> msat_ls_cc.py | grep simple
.. no output ..

<code class="prompt">dmm01#</code> <strong class="userinput"><code>rhncfg-client list</code></strong>
Using server name psat.example.org
No managed files.
</pre>

	</div><div class="para">
		From the hierarchy of the data elements of the <span class="emphasis"><em>simple</em></span> kickstart profile, we have left: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_kp_hy.py -l simple</code></strong>
simple
  simple
  1-simple
</pre>
		 We now also remove the activation key, <span class="emphasis"><em>1-simple</em></span>. Note that on the command line option, <code class="option">-l</code> or <code class="option">--activationkey-label</code>, we specify the '1-'. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_ak.py -l 1-simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		The Cobbler snippet <span class="emphasis"><em>simple</em></span> can be used by other kickstart profiles too. So, it is dangerous to just delete it. But, by naming convention we know that it belongs to the <span class="emphasis"><em>simple</em></span> kickstart profile, so it is save to remove it. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_cs.py -n simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		Now, all that is left from the kickstart profile's hierarchy, is the kickstart profile itself. We remove it here. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_kp.py -l simple</code></strong>
.. no output ..
</pre>

	</div><div class="para">
		What is still left from the kickstart profile <span class="emphasis"><em>simple</em></span>, is the system <span class="hardware">dmm01</span> that was installed using it. We can show this with: 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_ls_sys.py</code></strong>
id: 1000010000, name: test01.example.org
</pre>
		 Now, we remove the system from the Satellite too. 
<pre class="screen">
<code class="prompt">d19sw1#</code> <strong class="userinput"><code>msat_rm_sys.py -n test01.example.org</code></strong>
Removing the following systems (ID's):
1000010004
</pre>

	</div></div></div><div xml:lang="en-US" class="appendix" id="appe-msat-guide-Revision_History" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Revision History</h1></div></div></div><div class="para">
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 0.1-0</td><td align="left">Thu May 9 2013</td><td align="left"><span class="author"><span class="firstname">Allard</span> <span class="surname">Berends</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Brought book under publican</td></tr></table>

				</td></tr></table></div>

	</div></div><div class="index" id="idp3118832"><div class="titlepage"><div><div><h2 class="title">Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>F</h3><dl><dt>feedback</dt><dd><dl><dt>contact information for this manual, <a class="indexterm" href="#sect-msat-guide-We_Need_Feedback">We Need Feedback!</a></dt></dl></dd></dl></div></div></div></div></body></html>
